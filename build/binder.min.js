/*
 Author: Darren Schnare
 Keywords: javascript,binding,bind,property,list,observer,observable
 License: MIT ( http://www.opensource.org/licenses/mit-license.php )
 Repo: https://github.com/dschnare/binderjs
*/
function m(v){throw v;}var r=void 0,t=!0,x=null,z=!1;
(function(){function v(n){function o(i,h,g){function e(a){return a}var f=n.isArray,d=n.isObject,b=n.adheresTo,c=w.interfce,a={},C,B,y,k,j,p,l,s,q,h=h||a;"function"===typeof h?k=h:(k=h.filter,k="function"===typeof k?k:e);if(f(i)){q=u();c=i.length;for(d=0;d<c;d+=1)q.push(o(i[d],h));g&&(b(g,u.interfce)?g.merge(q):f(g)?g.push.apply(g,q):m(Error("Expected target to be an Array.")))}else if(d(i)){q={};C=u(h.include||[]);B=u(h.exclude||[]);y=u(h.copy||[]);for(l in i)if(i[l]!==r&&"function"!==typeof i[l]&&
(p=h.properties?h.properties[l]:a,s=i[l],j=p?p.create:e,j="function"===typeof j?j:e,s!==r&&(C.contains(l)||!B.contains(l))))if(y.contains(l))if(g)if(b(g[l],c))g[l](o(s,p));else g[l]=o(s,p);else q[l]=o(s,p);else if(f(s))if(g)if(b(g[l],c))g[l](o(s,p));else f(g[l])?o(s,p,g[l]):(j=w(j(o(s,p),g)),g[l]=j,j.owner=g);else j=w(j(o(s,p),q)),j.owner=q,q[l]=j;else if(d(s))if(g)if(b(g[l],c))g[l](o(s,p));else g[l]=o(s,p);else q[l]=o(s,p);else if(g)if(b(g[l],c))g[l](o(s,p));else j=w(j(o(s,p),g)),g[l]=j,j.owner=
g;else j=w(j(o(s,p),q)),j.owner=q,q[l]=j;q=k(q,i)}else q=k(i,i);return g||q}function v(i,h){function g(a){return a}var e,f,d,b,c;f={};b=n.isObject;d=n.isArray;var a=n.adheresTo,C=w.interfce,B,y,k,h=h||f;"function"===typeof h?k=h:(k=h.filter,k="function"===typeof k?k:g);if(d(i)){b=[];f=i.length;for(e=0;e<f;e+=1)b.push(v(i[e],h))}else if(b(i)){b={};B=u(h.include||[]);y=u(h.exclude||[]);for(e in i)if(i[e]!==r&&(B.contains(e)||!y.contains(e)))d=i[e],c=h.properties?h.properties[e]:f,b[e]=a(d,C)?v(d.get(),
c):v(d,c);b=k(b,i)}else b=k(i,i);return b}var E=[].constructor,u=function(){function i(e){var f=[];f.getItemOperators=function(){return n.create(g)};f.indexOf=f.indexOf||function(d,b){var c,a=this.length,b=isNaN(b)?0:b;if(0===a||b>=a)return-1;0>b&&(b=a+b);0>b&&(b=0);for(c=b;c<a;c+=1)if(this[c]===d)return c;return-1};f.lastIndexOf=f.lastIndexOf||function(d,b){var c;c=this.length;if(0===c)return-1;b=isNaN(b)?c:b;0<=b&&(b=b<c-1?b:c-1);0>b&&(b=c+b);for(c=b;0<=c;c-=1)if(this[c]===d)return c;return-1};
f.reverse=f.reverse||function(){for(var d=0,b=this.length,c=b-1,b=parseInt((b/2).toFixed(0),10),a;d<b;)a=this[c],this[c]=this[d],this[d]=a,c-=1,d+=1;return this};f.map=f.map||function(d,b){var c=0,a=this.length,e=[];e.length=a;"function"!==typeof d&&m(Error("TypeError"));for(c=0;c<a;c+=1)this.hasOwnProperty(c)&&(e[c]=d.call(b,this[c],c,this));return e};f.filter=f.filter||function(d,b){var c,a,e=this.length,f=[];"function"!==typeof d&&m(Error("TypeError"));for(c=0;c<e;c+=1)this.hasOwnProperty(c)&&
(a=this[c],d.call(b,a,c,this)&&f.push(a));return f};f.forEach=f.forEach||function(d,b){var c,a=this.length;"function"!==typeof d&&m(Error("TypeError"));for(c=0;c<a;c+=1)this.hasOwnProperty(c)&&d.call(b,this[c],c,this)};f.reduce=f.reduce||function(d,b){var c=this.length,a=0,e,f;"function"!==typeof d&&m(Error("TypeError"));0===c&&1===arguments.length&&m(Error("TypeError"));if(2===arguments.length)e=b;else{f=z;for(a=0;!f&&a<c;)(f=this.hasOwnProperty(a))&&(e=this[a]),a+=1}for(;a<c;)(f=this.hasOwnProperty(a))&&
(e=d.call(r,e,this[a],a,this)),a+=1;return e};f.reduceRight=f.reduceRight||function(d,b){var c=this.length,a=c-1,e;"function"!==typeof d&&m(Error("TypeError"));0===c&&1===arguments.length&&m(Error("TypeError"));if(2===arguments.length)e=b;else for(c=z;!c&&0<=a;)(c=this.hasOwnProperty(a))&&(e=this[a]),a-=1;for(;0<=a;)(c=this.hasOwnProperty(a))&&(e=d.call(r,e,this[a],a,this)),a-=1;return e};f.some=f.some||function(d,b){var c=this.length,a;"function"!==typeof d&&m(Error("TypeError"));for(a=0;a<c;a+=
1)if(this.hasOwnProperty(a)&&d.call(b,this[a],a,this))return t;return z};f.every=f.every||function(d,b){var c=this.length,a;"function"!==typeof d&&m(Error("TypeError"));for(a=0;a<c;a+=1)if(this.hasOwnProperty(a)&&!d.call(b,this[a],a,this))return z;return t};f.contains=function(d){return 0<=this.indexOf(d)};f.occurances=function(d){for(var b=this.indexOf(d),c=0;0<=b;)c+=1,b=this.indexOf(d,b+1);return c};f.distinct=function(){for(var d=this.length,b=[],c;d;)d-=1,c=this[d],1===this.occurances(c)&&b.unshift(c);
return b};f.first=function(d,b){var c,a=this.length;"function"!==typeof d&&m(Error("TypeError"));for(c=0;c<a;c+=1)if(this.hasOwnProperty(c)&&d.call(b,this[c],c,this))return this[c]};f.last=function(d,b){var c=this.length;for("function"!==typeof d&&m(Error("TypeError"));c;)if(c-=1,this.hasOwnProperty(c)&&d.call(b,this[c],c,this))return this[c]};f.find=function(d,b,c){var a=this.length;"function"!==typeof d&&m(Error("TypeError"));"number"!==typeof b&&!c&&(c=b);if(isNaN(b)||0>b)b=0;for(;b<a;b+=1)if(this.hasOwnProperty(b)&&
d.call(c,this[b],b,this))return{item:this[b],index:b};return{item:r,index:-1}};f.equals=function(d,b){var c,a,e,f;if(!n.isArray(d))return z;if(this===d)return t;if(this.length!==d.length)return z;a=this.length;e=d.length;f=i.getItemOperators(this);b="function"===typeof b?b:function(){return f.equals.apply(f,arguments)};for(c=0;c<a&&c<e;c+=1)if(!b(this[c],d[c]))return z;return t};f.changed=function(d,b,c){var a,e,f,g;if(!n.isArray(d)||this===d)return z;if(this.length!==d.length)return t;g=i.getItemOperators(this);
b="function"===typeof b?b:function(){return g.equals.apply(g,arguments)};c="function"===typeof c?c:function(){return g.changed.apply(g,arguments)};e=this.length;f=d.length;for(a=0;a<e&&a<f;a+=1)if(!b(this[a],d[a])||c(this[a],d[a]))return t;return z};f.compare=function(d,b,c){var a,e=i(),f,g,k,j=this.find,p,l,d=i(d);a=i.getItemOperators(this);b="function"===typeof b?b:function(){return a.equals.apply(a,arguments)};c="function"===typeof c?c:function(){return a.changed.apply(a,arguments)};p=function(a){return b(k,
a)};g=this.length;for(f=0;f<g;f+=1)k=this[f],l=j.call(d,p),0>l.index?e.push(h("deleted",k,f)):(c(k,l.item)?e.push(h("changed",k,f,l.item,l.index)):e.push(h("retained",k,f,l.item,l.index)),delete d[l.index]);g=d.length;for(f=0;f<g;f+=1)d.hasOwnProperty(f)&&(k=d[f],0>this.find(p).index&&e.push(h("added",r,-1,k,f)));k=d=b=c=x;return e};f.merge=function(d,b,c){var a=i(this);a.mergeWith(d,b,c);return a};f.mergeWith=function(d,b,c){var a;i.getItemOperators(this);d=this.compare(d,b,c);c=d.length;for(b=0;b<
c;b+=1)switch(a=d[b],a.status){case "added":this[a.otherIndex]===r?this[a.otherIndex]=a.otherItem:this.splice(a.otherIndex,0,a.otherItem);break;case "deleted":this[a.index]=r;break;case "changed":a.index!==a.otherIndex?this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item)):this[a.index]=a.otherItem;break;case "retained":a.index!==a.otherIndex?this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,
1),this.splice(a.otherIndex,0,a.item)):this[a.index]=a.otherItem}this.collapse()};f.remove=function(){var d,b,c,a=arguments.length;for(d=0;d<a;d+=1){c=arguments[d];for(b=this.length;b;)b-=1,this[b]===c&&this.splice(b,1)}};f.removeAt=function(d){if(isFinite(d)&&0<=d&&d<this.length)return this.splice(d,1).pop()};f.clear=function(){for(;this.length;)this.pop()};f.collapse=function(){for(var d=this.length;d;)d-=1,this[d]===r&&this.splice(d,1)};f.replaceAt=function(d,b){var c;isFinite(d)&&0<=d&&d<this.length&&
(c=this[d],this[d]=b);return c};f.isEmpty=function(){return 0===this.length};f.peek=function(){return this[this.length-1]};f.insert=function(d,b){d>this.length?d=this.length:0>d&&(d=0);return isFinite(parseInt(d,10))?(d===this.length?this.push(b):this.hasOwnProperty(d)?this.splice(d,0,b):this[d]=b,d):z};(function(d){var b=d.length;1===b&&n.isArray(e)?f.push.apply(f,e):b&&f.push.apply(f,f.slice.call(d))})(arguments);return f}function h(e,f,d,b,c){return{status:e,item:f,value:f,index:d,otherItem:b,
otherIndex:c,toString:function(){return n.format("{status: {0}, item: {1}, index: {2}, otherItem: {3}, otherIndex: {4}}",e,f,d,b,c)}}}var g={equals:function(e,f){e=e?e.valueOf():e;f=f?f.valueOf():f;return e===f},changed:function(e,f){e=e?e.valueOf():e;f=f?f.valueOf():f;return e!==f}};i.getItemOperators=function(e){e=e.getItemOperators();"function"!==typeof e.equals&&(e.equals=g.equals);"function"!==typeof e.changed&&(e.changed=g.changed);return e};i.interfce={concat:"function",indexOf:"function",
join:"function",lastIndexOf:"function",map:"function",filter:"function",forEach:"function",reduce:"function",reduceRight:"function",reverse:"function",some:"function",shift:"function",slice:"function",sort:"function",splice:"function",every:"function",pop:"function",push:"function",unshift:"function",toString:"function",contains:"function",occurances:"function",distinct:"function",first:"function",last:"function",find:"function",equals:"function",changed:"function",compare:"function",merge:"function",
mergeWith:"function",remove:"function",removeAt:"function",clear:"function",collapse:"function",replaceAt:"function",isEmpty:"function",peek:"function",insert:"function"};return i}(),A=function(){function i(){var e=u(),f=0,d=z,b=[],c=-1;return{block:function(){b.push(t)},unblock:function(){b.pop()},subscribe:function(a,b){return a&&!e.contains(a)?(a.thisObj=b||r,e.push(a),{dispose:function(){e.remove(a)}}):{dispose:function(){}}},throttle:function(a){isFinite(a)||(a=0);f=a},notify:function(){var a=
this,i=g.call(arguments);!b.length&&!d&&(d=t,0<f?c=setTimeout(function(){h(a,e,i);d=z},f):(h(a,e,i),d=z))},dispose:function(){e.clear();clearTimeout(c)}}}function h(e,f,d){var b,c=f.length,d=d.slice();d.unshift(e);for(e=0;e<c;e+=1)(b=f[e])&&("function"===typeof b?b.apply(b.thisObj,d):"function"===typeof b.onNotify&&b.onNotify.apply(b,d))}var g=E.prototype.slice;i.interfce={block:"function",unblock:"function",subscribe:"function",throttle:"function",notify:"function",dispose:"function"};return i}(),
D=function(){function i(){function h(d,b,c,a,e){b=parseInt(b,10);a=parseInt(a,10);return{action:d,newStartingIndex:isFinite(b)?b:-1,newItems:n.isArray(c)?c:c===x||c===r?[]:[c],oldStartingIndex:isFinite(a)?a:-1,oldItems:n.isArray(e)?e:e===x||e===r?[]:[e]}}var g=[].slice,e=u.apply(r,g.call(arguments)),f={add:function(d,b){e.notify(h("add",d,b))},remove:function(d,b){e.notify(h("remove",x,x,d,b))},replace:function(d,b,c,a){e.notify(h("replace",d,b,c,a))},move:function(d,b,c,a){e.notify(h("move",d,b,
c,a))},reset:function(){e.notify(h("reset"))}};n.mixin(e,A());e.replaceAt=function(d){return function(b,c){var a;0<=b&&b<this.length&&(this.block(),a=d.call(this,b,c),this.unblock(),f.replace(b,c,b,a));return a}}(e.replaceAt);e.clear=function(d){return function(){var b=this.length;this.block();d.call(this);this.unblock();b!==this.length&&f.reset()}}(e.clear);e.collapse=function(d){return function(){var b=this.length;this.block();d.call(this);this.unblock();b!==this.length&&f.reset()}}(e.collapse);
e.insert=function(d){return function(b,c){this.block();var a=d.call(this,b,c);this.unblock();a!==z&&f.add(a,c);return a}}(e.insert);e.mergeWith=function(){return function(d,b,c){var a,e=[];this.block();u.getItemOperators(this);d=this.compare(d,b,c);c=d.length;for(b=0;b<c;b+=1)switch(a=d[b],a.status){case "added":e.push(h("add",a.otherIndex,a.otherItem));this[a.otherIndex]===r?this[a.otherIndex]=a.otherItem:this.splice(a.otherIndex,0,a.otherItem);break;case "deleted":e.push(h("remove",x,x,a.index,
a.item));this[a.index]=r;break;case "changed":a.index!==a.otherIndex?(e.push(h("move",a.otherIndex,a.otherItem,a.index,a.item)),this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item))):(e.push(h("replace",a.index,a.otherItem,a.index,a.item)),this[a.index]=a.otherItem);break;case "retained":a.index!==a.otherIndex?(e.push(h("move",a.otherIndex,a.otherItem,a.index,a.item)),this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=
a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item))):this[a.index]=a.otherItem}this.collapse();for(this.unblock();e.length;)this.notify(e.shift())}}(e.mergeWith);e.reverse=function(d){return function(){this.block();d.call(this);this.unblock();f.reset();return this}}(e.reverse);e.pop=function(d){return function(){var b=this.length,c;this.block();c=d.call(this);this.unblock();b!==this.length&&f.remove(b-1,c);return c}}(e.pop);e.push=function(d){return function(){var b=this.length,
c=g.call(arguments),a;this.block();a=d.apply(this,c);this.unblock();b!==a&&f.add(b,c);return a}}(e.push);e.shift=function(d){return function(){var b=this.length,c;this.block();c=d.call(this);this.unblock();b!==this.length&&f.remove(0,c);return c}}(e.shift);e.unshift=function(d){return function(){var b=this.length,c=g.call(arguments),a;this.block();a=d.apply(this,c);this.unblock();b!==this.length&&f.add(0,c);return a}}(e.unshift);e.sort=function(d){return function(){d.apply(this,g.call(arguments));
f.reset();return this}}(e.sort);e.splice=function(d){return function(b,c){var a=this.length,e=g.call(arguments,2),h,b=parseInt(b,10),b=isFinite(b)?b:0;0>b?b=0:b>this.length&&(b=this.length);this.block();h=d.apply(this,g.call(arguments));this.unblock();a!==this.length&&(0===e.length&&0!==h.length?f.remove(b,h):0!==e.length&&0===h.length?f.add(b,e):f.replace(b,e,b,h));return h}}(e.splice);return e}i.interfce=n.mixin({},A.interfce,u.interfce);return i}(),w=function(){var i,h,g=u();g.b=function(e){this.push(e)};
g.a=function(e){this.length&&this.peek().dependencies().add(e)};i=function(e,f,d){function b(){k=r;j.notify()}var c=z,a=u(),i=[],o,y,k,j;a.add=function(a){this.contains(a)||(this.push(a),i.push(a.subscribe(b)))};j=function(a){var b,d=j.owner;this!==r&&(j.owner=this);arguments.length?(j.set(a),b=this):b=j.get();j.owner=d;return b};j.equals=function(a){var b=this.get(),a=h(a),b=b?b.valueOf():b,a=a?a.valueOf():a;return b===a};j.changed=function(a){var b=this.get(),a=h(a),b=b?b.valueOf():b,a=a?a.valueOf():
a;return b!==a};j.clearMemo=function(){k=r};j.get=function(){c||(g.a(this),g.b(this));var a=k===r?y.call(this.owner):k;k=a;g[g.length-1]===this&&g.pop();return a};j.set=function(a){if("function"===typeof o){c=t;if(!this.equals(a)||this.changed(a))this.block(),o.call(this.owner,a),k=r,this.unblock(),this.notify();c=z}};j.dependencies=function(){return a};j.isDependent=function(){return 0!==a.length};j.toString=function(){return n.str(this.get())};j.valueOf=function(){var a=this.get();return n.isNil(a)?
a:a.valueOf()};n.mixin(j,A());(function(){var c,g=j,k=z,q=n.isObject,v=n.isArray,w=n.adheresTo;g.owner=r;"function"===typeof e?(y=e,o="function"===typeof f?f:x,g.owner="function"===typeof f?d:f):q(e)&&"function"===typeof e.get?(k=e.lazy,y=e.get,o="function"===typeof e.set?e.set:x,g.equals="function"===typeof e.equals?e.equals:g.equals,g.changed="function"===typeof e.changed?e.changed:g.changed,g.owner=e.owner):(q(e)?(g.equals="function"===typeof e.equals?e.equals:g.equals,g.changed="function"===typeof e.changed?
e.changed:g.changed,c=e.value):c=e,v(c)&&!w(c,A.interfce)&&(c=D(c),c.getItemOperators=function(a,b,c){a=typeof a==="function"?a:c.equals;b=typeof b==="function"?b:c.changed;return function(){return{equals:a,changed:b}}}(e.equals,e.changed,c.getItemOperators()),g.equals=function(a){a=h(a);return c.equals(a)},g.changed=function(a){a=h(a);return c.changed(a)}),c&&"function"===typeof c.subscribe&&"function"===typeof c.dispose&&i.push(c.subscribe(b)),y=function(){return c},o=function(a){if(w(c,u.interfce)){c.clear();
v(a)?c.push.apply(c,a):c.push(a)}else if(v(c)){for(;c.length;)c.pop();v(a)?c.push.apply(c,a):c.push(a)}else c!==a&&(c=a)});g.dispose=function(b){return function(){for(;i.length;)i.pop().dispose();for(;a.length;)a.pop();b.call(this)}}(g.dispose);k||j.get()})();return j};h=function(e){return e&&"function"===typeof e.get?e.get():e};i.get=h;i.interfce=n.mixin({dependencies:"function",isDependent:"function",clearMemo:"function",get:"function",set:"function",equals:"function",changed:"function"},A.interfce);
return i}();return{makeList:u,makeObservable:A,makeObservableList:D,makeProperty:w,makeBinding:function(){function i(h,g,e){var f=w.interfce,d=[],e=e||"twoway",e=n.str(e),e=e.toLowerCase();n.adheresTo(h,f)||m(Error("Binding source must be an observable property. "+h));n.adheresTo(g,f)||m(Error("Binding sink must be an observable property. "+g));g.set(h.get());switch(e){case "oneway":f=h.subscribe(function(){g.set(h.get())});d.push(f);break;case "twoway":f=h.subscribe(function(){g.set(h.get())}),d.push(f),
f=g.subscribe(function(){h.set(g.get())}),d.push(f)}f=x;return{type:function(){return e},source:function(){return h},sink:function(){return g},dispose:function(){for(;d.length;)d.pop().dispose()}}}i.interfce={type:"function",source:"function",sink:"function",dispose:"function"};return i}(),toJSON:v,fromJSON:o}}xport.module(["utiljs"],v,function(){xport("BINDER",v(UTIL))})})();
