/*
Author: Darren Schnare
Keywords: javascript,binding,bind,property,list,observer,observable
License: MIT ( http://www.opensource.org/licenses/mit-license.php )
Repo: https://github.com/dschnare/binderjs
*/
(function(n,t){"use strict";var f=function(n,t){return{adherenceTest:function(){var i=n.makeObservable();t.expect('binder.makeObservable to contain the property "interfce"',typeof n.makeObservable.interfce=="object"&&n.makeObservable.interfce),t.expect('"ob" to adhere to the "binder.makeObservable.interfce" interface',n.utiljs.adheresTo(i,n.makeObservable.interfce))},subscriptionTest:function(){var u=n.makeObservable(),r=!1,e=function(){r=!0},i={onNotify:function(){this.notified=!0}},f={};u.notify(),t.dontExpect('"fn" to be called',r),t.dontExpect('"observer.onNotify" to be called',i.notified),f.fn=u.subscribe(e),f.observer=u.subscribe(i),r=!1,delete i.notified,u.notify(),t.expect('"fn" to be called',r),t.expect('"observer.onNotify" to be called',i.notified),f.fn.dispose(),r=!1,delete i.notified,u.notify(),t.dontExpect('"fn" to be called',r),t.expect('"observer.onNotify" to be called',i.notified),f.observer.dispose(),r=!1,delete i.notified,u.notify(),t.dontExpect('"fn" to be called',r),t.dontExpect('"observer.onNotify" to be called',i.notified),t.dontExpectToThrow('"subscriptions.fn.dispose" to throw an error',function(){f.fn.dispose()}),t.dontExpectToThrow('"subscriptions.observer.dispose" to throw an error',function(){f.observer.dispose()}),r=!1,delete i.notified,u.notify(),t.dontExpect('"fn" to be called',r),t.dontExpect('"observer.onNotify" to be called',i.notified),u.subscribe(e),u.subscribe(i),r=!1,delete i.notified,u.dispose(),u.notify(),t.dontExpect('"fn" to be called',r),t.dontExpect('"observer.onNotify" to be called',i.notified)},blockingTest:function(){var i=n.makeObservable(),r=!1,u=function(){r=!0};i.notify(),t.dontExpect('"fn" to be called',r),r=!1,i.subscribe(u),i.unblock(),i.notify(),t.expect('"fn" to be called',r),r=!1,i.block(),i.notify(),t.dontExpect('"fn" to be called',r),i.unblock(),t.dontExpect('"fn" to be called',r),i.dispose()},throttlingTest:function(){var i=n.makeObservable(),u=!1,f=function(){u=!0},r=t.util.promise.create();return i.subscribe(f),i.throttle(500),i.notify(),i.notify(),t.dontExpect('"fn" to be called',u),setTimeout(function(){u?r.fulfill():r.smash('Expected "fn" to be called after 500 milliseconds')},500),r},throttlingAndObservableDisposalTest:function(){var i=n.makeObservable(),u=!1,f=function(){u=!0},r=t.util.promise.create();return i.subscribe(f),i.throttle(500),i.notify(),i.dispose(),t.dontExpect('"fn" to be called',u),setTimeout(function(){u?r.smash('Did not expect "fn" to be called after 500 milliseconds'):r.fulfill()},500),r},throttlingAndSubscriptionDisposalTest:function(){var u=n.makeObservable(),r=!1,e=function(){r=!0},i=t.util.promise.create(),f;return f=u.subscribe(e),u.throttle(500),u.notify(),f.dispose(),t.dontExpect('"fn" to be called',r),setTimeout(function(){r?i.smash('Did not expect "fn" to be called after 500 milliseconds'):i.fulfill()},500),i}}}(BINDER,UNIT),e=function(n,t){return{setupSuite:function(){this.list=n.makeList(1,2,3)},destroySuite:function(){delete this.list},adherenceTest:function(){t.expect("the list to be a native Array",Object.prototype.toString.call(this.list)==="[object Array]")},indexOfTest:function(){t.expect("list to have an indexOf() method",typeof this.list.indexOf=="function"),t.expect("index of 2 to be 1",this.list.indexOf(2)===1),t.expect("index of 1 to be 0",this.list.indexOf(1)===0),t.expect("index of 10 to be less than zero",this.list.indexOf(10)<0)},lastIndexOf:function(){t.expect("list to have an lastIndexOf() method",typeof this.list.lastIndexOf=="function")},reverse:function(){t.expect("list to have an reverse() method",typeof this.list.reverse=="function")},map:function(){t.expect("list to have an map() method",typeof this.list.map=="function")},filter:function(){t.expect("list to have an filter() method",typeof this.list.filter=="function")},forEach:function(){t.expect("list to have an forEach() method",typeof this.list.forEach=="function")},reduce:function(){t.expect("list to have an reduce() method",typeof this.list.reduce=="function")},reduceRight:function(){t.expect("list to have an reduceRight() method",typeof this.list.reduceRight=="function")},some:function(){t.expect("list to have an some() method",typeof this.list.some=="function")},every:function(){t.expect("list to have an every() method",typeof this.list.every=="function")},contains:function(){t.expect("list to have an contains() method",typeof this.list.contains=="function")},occurances:function(){t.expect("list to have an occurances() method",typeof this.list.occurances=="function")},distinct:function(){t.expect("list to have an distinct() method",typeof this.list.distinct=="function")},first:function(){t.expect("list to have an first() method",typeof this.list.first=="function")},last:function(){t.expect("list to have an last() method",typeof this.list.last=="function")},find:function(){t.expect("list to have an find() method",typeof this.list.find=="function")},equals:function(){t.expect("list to have an equals() method",typeof this.list.equals=="function")},changed:function(){t.expect("list to have an changed() method",typeof this.list.changed=="function")},compare:function(){t.expect("list to have an compare() method",typeof this.list.compare=="function")},merge:function(){t.expect("list to have an merge() method",typeof this.list.merge=="function")},mergeWith:function(){t.expect("list to have an merveWith() method",typeof this.list.mergeWith=="function")},remove:function(){t.expect("list to have an remove() method",typeof this.list.remove=="function")},removeAt:function(){t.expect("list to have an removeAt() method",typeof this.list.removeAt=="function")},clear:function(){t.expect("list to have an clear() method",typeof this.list.clear=="function")},collapse:function(){t.expect("list to have an collapse() method",typeof this.list.collapse=="function")},replaceAt:function(){t.expect("list to have an replaceAt() method",typeof this.list.replaceAt=="function")},isEmpty:function(){t.expect("list to have an isEmpty() method",typeof this.list.isEmpty=="function")},peek:function(){t.expect("list to have an peek() method",typeof this.list.peek=="function")},insert:function(){t.expect("list to have an insert() method",typeof this.list.insert=="function")}}}(BINDER,UNIT),u=function(){return{}}(BINDER,UNIT),i=function(n,t){var i=function(n){t.expect('"p.toString()" to be equal to "1,2,3"',n.toString()==="1,2,3"),t.expect('"p().join(",")" to be equal to "1,2,3"',n().join(",")==="1,2,3"),t.expect('"p.get().join(",")" to be equal to "1,2,3"',n.get().join(",")==="1,2,3"),t.expect('"p.valueOf().join(",")" to be equal to "1,2,3"',n.valueOf().join(",")==="1,2,3"),n().push(4),t.expect('"p.valueOf().join(",")" to be equal to "1,2,3,4"',n.valueOf().join(",")==="1,2,3,4");var i=!1;n.subscribe(function(){i=!0}),i=!1,n().remove(1),t.expect("the property to be notified when the first element is removed",i),i=!1,n().clear(),t.expect("the property to be notified when the list is cleared",i),i=!1,n().push(1,2,3),t.expect("the property to be notified when new items are pushed onto the list",i),i=!1,n().pop(),t.expect("the property to be notified when an item is popped off the list",i),i=!1,n().shift(),t.expect("the property to be notified when item is removed from front of list",i),i=!1,n().unshift(1),t.expect("the property to be notified when item is prepended to front of list",i),i=!1,n().splice(0,1),t.expect("the property to be notified when the list is spliced",i),i=!1,n().splice(0,0),t.dontExpect("the property to be notified when the list is spliced but zero elements are removed and added",i),n().push(10),i=!1,n().sort(),t.expect("the property to be notified when the list is sorted",i),i=!1,n().insert(0,11),t.expect("the property to be notified when an item is inserted",i),i=!1,n().reverse(),t.expect("the property to be notified when the list is reversed",i),i=!1,n().replaceAt(0,99),t.expect("the property to be notified when an item is replaced",i),i=!1,n()[0]=undefined,n().collapse(),t.expect("the property to be notified when a sparse list is collapsed",i)};return{adherenceTest:function(){var i=n.makeProperty("value");t.expect('"p" to adhere to the "binder.makeProperty.interfce" interface',n.utiljs.adheresTo(i,n.makeProperty.interfce)),t.dontExpect('"p" to not be dependent',i.isDependent()),t.expect('"p" to have no dependencies',i.dependencies().length===0),t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value"),i("value2"),t.expect('"p.toString()" to be equal to "value2"',i.toString()==="value2"),t.expect('"p.valueOf()" to be equal to "value2"',i.valueOf()==="value2"),t.expect('"p.get()" to be equal to "value2"',i.get()==="value2"),t.expect('"p()" to be equal to "value2"',i()==="value2"),i.set("value3"),t.expect('"p.toString()" to be equal to "value3"',i.toString()==="value3"),t.expect('"p.valueOf()" to be equal to "value3"',i.valueOf()==="value3"),t.expect('"p.get()" to be equal to "value3"',i.get()==="value3"),t.expect('"p()" to be equal to "value3"',i()==="value3"),i.dispose()},dependenciesTest:function(){var r=n.makeProperty("Super"),e=n.makeProperty("Mario"),f=!1,i=n.makeProperty(function(){return r+" "+e}),u=i.dependencies();t.expect('"fullName" to be dependent',i.isDependent()),t.expect('"fullName" to be dependent on "fname" and "lname"',u.contains(r)&&u.contains(e)),t.expect('"fullName()" to be equal to "Super Mario"',i()==="Super Mario"),i.subscribe(function(){f=!0}),r.set("super"),t.expect('"fullName" to be notified that "fname" has been changed',f),t.expect('"fullName()" to be equal to "super Mario"',i()==="super Mario"),f=!1,i.dispose(),r.set("Super"),t.dontExpect('"fullName" to be notified that "fname" has been changed',f),t.dontExpect('"fullName" to be dependent',i.isDependent()),t.dontExpect('"fullName" to be dependent on "fname" and "lname"',u.contains(r)&&u.contains(e)),t.expect('"fullName()" to be equal to "super Mario"',i()==="super Mario")},memoizationTest:function(){var i=!1,r=n.makeProperty(function(){return i=!0,"value"});t.expect("property to have been called",i),i=!1,r(),t.dontExpect("property to have been called",i),r.clearMemo(),r(),t.expect("property to have been called",i)},lazyTest:function(){var i=!1,r=n.makeProperty({lazy:!0,get:function(){return i=!0,"value"}});t.dontExpect("property to have been called",i),r(),t.expect("property to have been called",i)},simpleConstructionTest:function(){var i=n.makeProperty("value");t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value")},valueParameterizedConstructionTest:function(){var i=n.makeProperty({value:"value"});t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value")},getConstructionTest:function(){var r=!1,i=n.makeProperty({get:function(){return r=!0,"value"}});t.expect("the custom getter to be called",r),t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value")},getSetConstructionTest:function(){var u=!1,r=!1,i=n.makeProperty({get:function(){return u=!0,"value"},set:function(){r=!0}});t.expect("the custom getter to be called",u),t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value"),i("value"),t.dontExpect("the custom setter to be called",r),i("new value"),t.expect("the custom setter to be called",r)},getSetLazyConstructionTest:function(){var r=!1,u=!1,i=n.makeProperty({lazy:!0,get:function(){return r=!0,"value"},set:function(){u=!0}});t.dontExpect("the custom getter to be called",r),t.expect('"p.toString()" to be equal to "value"',i.toString()==="value"),t.expect("the custom getter to be called",r),t.expect('"p.valueOf()" to be equal to "value"',i.valueOf()==="value"),t.expect('"p.get()" to be equal to "value"',i.get()==="value"),t.expect('"p()" to be equal to "value"',i()==="value"),i("value"),t.dontExpect("the custom setter to be called",u),i("new value"),t.expect("the custom setter to be called",u)},observableValuePropertyTest:function(){var r=n.makeObservable(),i=n.makeProperty(r),u;t.expect('"p.toString()" to be equal to the empty string',i.toString()===""),t.expect('"p.valueOf()" to be equal to undefined',i.valueOf()===undefined),t.expect('"p.get()" to be equal to undefined',i.get()===undefined),t.expect('"p()" to be equal to undefined',i()===undefined),r.valueOf=function(){return"observable"},r.toString=r.valueOf,i=n.makeProperty({value:r}),t.expect('"p.toString()" to be equal to "o.toString()"',i.toString()===r.toString()),t.expect('"p.valueOf()" to be equal to "o.valueOf()"',i.valueOf()===r.valueOf()),t.expect('"p.get()" to be equal to o',i.get()===r),t.expect('"p()" to be equal to o',i()===r),u=!1,i.subscribe(function(){u=!0}),r.notify(),t.expect('the property to be notified when "o" has been notified',u),i.dispose()},operatorsTest:function(){var r=!1,u=!1,i=n.makeProperty({value:{id:0,label:"apple"},equals:function(t){r=!0;var i=this.get();return t=n.makeProperty.get(t),i.id===t.id},changed:function(t){u=!0;var i=this.get();return t=n.makeProperty.get(t),i.label!==t.label}});t.expect("property to be equal to {id: 0}",i.equals({id:0})),t.expect("custom equality operator to be called",r),t.expect('property to be equal to {id: 0, label: "pear"} and will be changed if set',i.equals({id:0,label:"pear"})&&i.changed({id:0,label:"pear"})),t.expect("custom equality operator to be called",u)},arrayTest:function(){var t=n.makeProperty([1,2,3]);i(t)},observableListTest:function(){var r=n.makeObservableList([1,2,3]),t=n.makeProperty(r);i(t)},listOperatorsTest:function(){var r=n.makeProperty({value:n.makeList({id:0,label:"apple"},{id:1,label:"pear"},{id:2,label:"orange"}),equals:function(n,t){return n.id===t.id},changed:function(n,t){return n.label!==t.label}}),i=n.makeList({id:0,label:"apple"},{id:1,label:"pear"},{id:2,label:"orange"});t.expect("the property to equal the list",r.equals(i)),i.pop(),t.dontExpect("the property to equal the list",r.equals(i)),t.expect("the property to change if set to the list",r.changed(i))}}}(BINDER,UNIT),r=function(){return{}}(BINDER,UNIT);t.makeTestHarness("Binderjs Test Harness","Observable Test Suite",f,"List Test Suite",e,"ObservableList Test Suite",u,"Property Test Suite",i,"Binding Test Suite",r).run()})(BINDER,UNIT)