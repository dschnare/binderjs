/*
Author: Darren Schnare
Keywords: javascript,binding,bind,property,list,observer,observable
License: MIT ( http://www.opensource.org/licenses/mit-license.php )
Repo: https://github.com/dschnare/binderjs
*/
var BINDER=function(){"use strict";var s=[].constructor,e={}.constructor,n=function(){var n={object:{typeOf:function(t){return t===null?"null":n.object.isArray(t)?"array":typeof t},isObject:function(t){return t&&n.object.typeOf(t)==="object"},isArray:function(){var n=e.prototype.toString;return function(t){return n.call(t)==="[object Array]"}}(),isNil:function(n){return n===null||n===undefined},adheresTo:function(t,i){var r,o,e,s=n.object.isObject,f=n.object.isArray,h=n.string.toString,u=n.object.typeOf;if((s(t)||typeof t=="function"||f(t))&&(s(i)||typeof i=="function"||f(i))){for(r in i)if(i.hasOwnProperty(r))if(i[r]==="*"){if(t[r]===undefined)return!1}else if(u(t[r])!==u(i[r])&&u(t[r])!==h(i[r]))return!1;return!0}return o=u(t),e=u(i),o===e},mixin:function(t){var e=n.object.isNil,f=arguments.length,r,i,u;if(f===0||!t)return t;for(r=1;r<f;r+=1){i=arguments[r];if(!e(i))for(u in i)i.hasOwnProperty(u)&&(t[u]=i[u])}return t},create:function(){var n=function(){};return function(t){return n.prototype=t,new n}}()},string:{toString:function(n){return n===undefined||n===null?"":n.toString()},trim:function(n){var t=0,i=n.charAt(t);while(i){if(i>" "){n=n.substring(t);break}t+=1,i=n.charAt(t)}t=n.length;while(t){t-=1,i=n.charAt(t);if(i>" "){n=n.substring(0,t+1);break}}return n},format:function(t){var u=n.string.toString(t),s=arguments,h=s.length,f=u.length,r=null,i=0,o=0,e=function(){return f-=1,r=u.charAt(f)};while(e())if(r==="}"){o=f+1,e(),i="";while(r>="0"&&r<="9")i=r+i,e();r==="{"&&(i=parseInt(i,10)+1,i<h&&(u=u.substring(0,f)+s[i]+u.substring(o)))}return u}}};return n}(),t=function(n){var r={equals:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,n===t},changed:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,!1}},i=function(t,i,r,u,f){return{status:t,item:i,value:i,index:r,otherItem:u,otherIndex:f,toString:function(){var e="{status: {0}, item: {1}, index: {2}, otherItem: {3}, otherIndex: {4}}";return n.string.format(e,t,i,r,u,f)}}},t=function(u){var f=[];return f.getItemOperators=function(){return n.object.create(r)},f.indexOf=f.indexOf||function(n,t){var i,r=this.length;t=isNaN(t)?0:t;if(r===0)return-1;if(t>=r)return-1;for(t<0&&(t=r+t),t<0&&(t=0),i=t;i<r;i+=1)if(this[i]===n)return i;return-1},f.lastIndexOf=f.lastIndexOf||function(n,t){var i,r=this.length,u=function(n,t){return n<t?n:t};if(r===0)return-1;for(t=isNaN(t)?r:t,t<0||(t=u(t,r-1)),t<0&&(t=r+t),i=t;i>=0;i-=1)if(this[i]===n)return n=null,i;return n=null,-1},f.reverse=f.reverse||function(){var n=0,i=this.length,t=i-1,r=parseInt(i/2,10);while(n<r)this[t]=this[n],t-=1,n+=1;return this},f.map=f.map||function(n,t){var i,u=this.length,r=[];if(typeof n!="function")throw new Error("TypeError");for(i=0;i<u;i+=1)this.hasOwnProperty(i)&&(r[i]=n.call(t,this[i],i,this));return r},f.filter=f.filter||function(n,t){var i,r,f=this.length,u=[];if(typeof n!="function")throw new Error("TypeError");for(i=0;i<f;i+=1)this.hasOwnProperty(i)&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u},f.forEach=f.forEach||function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)this.hasOwnProperty(i)&&n.call(t,this[i],i,this)},f.reduce=f.reduce||function(n,t){var f=this.length,i,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1,i=0;while(!r&&i<f)r=this.hasOwnProperty(i),r&&(u=this[i]),i+=1}while(i<f)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i+=1;return u},f.reduceRight=f.reduceRight||function(n,t){var f=this.length,i,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1,i=f-1;while(!r&&i>=0)r=this.hasOwnProperty(i),r&&(u=this[i]),i-=1}while(i>=0)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i-=1;return u},f.some=f.some||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return!0;return!1},f.every=f.every||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(!n.call(t,this[i],i,this))return!1;return!0},f.contains=function(n){return this.indexOf(n)>=0},f.occurances=function(n){var t=this.indexOf(n),i=0;while(t>=0)i+=1,t=this.indexOf(n,t+1);return i},f.distinct=function(){var t=this.length,i=[],n;while(t)t-=1,n=this[t],this.occurances(n)===1&&i.push(n);return i},f.first=function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i];return undefined},f.last=function(n,t){var i=this.length;if(typeof n!="function")throw new Error("TypeError");while(i){i-=1;if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i]}return undefined},f.find=function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return{item:this[i],index:i};return{item:undefined,index:-1}},f.equals=function(i,r){var u,s,h,f=this,e=i,o;if(!n.object.isArray(i))return!1;if(f===e)return!0;if(f.length!==e.length)return!1;for(s=f.length,h=e.length,o=t.getItemOperators(this),r=typeof r=="function"?r:function(){return o.equals.apply(o,arguments)},u=0;u<s&&u<h;u+=1)if(!r(f[u],e[u]))return!1;return!0},f.changed=function(i,r,u){var f,h,c,e=this,o=i,s;if(!n.object.isArray(i))return!1;if(e===o)return!1;if(e.length!==o.length)return!0;for(s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},h=e.length,c=o.length,f=0;f<h&&f<c;f+=1)if(!r(e[f],o[f])||u(e[f],o[f]))return!0;return!1},f.compare=function(n,r,u){var s,h=t(),f,c,e,a=this.find,l,o;for(s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},l=function(n){return r(e,n)},c=this.length,f=0;f<c;f+=1)e=this[f],o=a.call(n,l),o.item===undefined?h.push(i("deleted",e,f)):u(e,o.item)?h.push(i("changed",e,f,o.item,o.index)):h.push(i("retained",e,f,o.item,o.index));for(c=n.length,f=0;f<c;f+=1)e=n[f],this.find(l).item===undefined&&h.push(i("added",undefined,-1,e,f));return e=n=r=u=null,h},f.merge=function(n,i,r){var u=t(this);return u.mergeWith(n,i,r),u},f.mergeWith=function(n,i,r){var f,o,e,u;f=t.getItemOperators(this),o=this.compare(n,i,r),e=o.length,this.length=n.length;while(e){e-=1,u=o[e];switch(u.status){case"added":this[u.otherIndex]=u.otherItem;break;case"deleted":f.equals(this[u.index],u.item)&&(this[u.index]=undefined);break;case"changed":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.otherItem;break;case"retained":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.item}}this.collapse()},f.remove=function(){for(var n,i,r=arguments.length,t=0;t<r;t+=1){i=arguments[t],n=this.length;while(n)n-=1,this[n]===i&&this.splice(n,1)}},f.removeAt=function(n){if(isFinite(n)&&n>=0&&n<this.length)return this.splice(n,1).pop()},f.clear=function(){while(this.length)this.pop()},f.collapse=function(){var n=this.length;while(n)n-=1,this.hasOwnProperty(n)||this.splice(n,1)},f.replaceAt=function(n,t){isFinite(n)&&n>=0&&n<this.length&&(this[n]=t)},f.isEmpty=function(){return this.length===0},f.peek=function(){return this[this.length-1]},f.insert=function(n,t){n<0||n>this.length+1||(n===this.length+1?this.push(t):this.hasOwnProperty(n)?this.splice(n,0,t):this[n]=t)},function(t){var i=t.length;i===1&&n.object.isArray(u)?f.push.apply(f,u):i&&f.push.apply(f,f.slice.call(t))}(arguments),f};return t.getItemOperators=function(n){var t=n.getItemOperators();return typeof t.equals!="function"&&(t.equals=r.equals),typeof t.changed!="function"&&(t.changed=r.changed),t},t.interfce={concat:"function",indexOf:"function",join:"function",lastIndexOf:"function",map:"function",filter:"function",forEach:"function",reduce:"function",reduceRight:"function",reverse:"function",some:"function",shift:"function",slice:"function",sort:"function",splice:"function",every:"function",pop:"function",push:"function",unshift:"function",toString:"function",contains:"function",occurances:"function",distinct:"function",first:"function",last:"function",find:"function",equals:"function",changed:"function",compare:"function",merge:"function",mergeWith:"function",remove:"function",removeAt:"function",clear:"function",collapse:"function",replaceAt:"function",isEmpty:"function",peek:"function",insert:"function"},t}(n),r=function(n,t){var r=function(n,t){for(var i,u=t.length,r=0;r<u;r+=1){i=t[r];if(i)if(typeof i=="function")i(n);else if(typeof i.onNotify=="function")i.onNotify(n)}},i=function(){var i=n(),e=0,u=!1,f=!1;return{block:function(){f=!0},unblock:function(){f=!1},subscribe:function(n){return n&&!i.contains(n)?(i.push(n),{dispose:function(){i.remove(n)}}):{dispose:function(){}}},throttle:function(n){isFinite(n)||(n=0),e=n},notify:function(){var n=this;if(f||u)return;u=!0,e>0?t(function(){r(n,i),u=!1},e):(r(n,i),u=!1)},dispose:function(){i.clear()}}};return i.interfce={block:"function",unblock:"function",subscribe:"function",throttle:"function",notify:"function",dispose:"dispose"},i}(t,setTimeout),u=function(n,t,i){var r=function(){var u=[].slice,r=t.apply(undefined,u.call(arguments));return n.object.mixin(r,i()),r.remove=function(n){return function(){var t=this.length;this.block(),n.apply(this,u.call(arguments)),this.unblock(),t!==this.length&&this.notify()}}(r.remove),r.clear=function(n){return function(){var t=this.length;this.block(),n.call(this),this.unblock(),t!==this.length&&this.notify()}}(r.clear),r.collapse=function(n){return function(){var t=this.length;this.block(),n.call(this),this.unblock(),t!==this.length&&this.notify()}}(r.collapse),r.insert=function(n){return function(t,i){this.block(),n.call(this,t,i),this.unblock(),this.notify()}}(r.insert),r.mergeWith=function(n){return function(t,i,r){this.block(),n.call(this,t,i,r),this.unblock(),this.notify()}}(r.mergeWith),r.replaceAt=function(n,t){isFinite(n)&&n>=0&&n<this.length&&(this[n]=t,this.notify())},r.reverse=function(n){return function(){var t;return this.block(),t=n.call(this),this.unblock(),this.notify(),t}}(r.reverse),r.pop=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.pop),r.push=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.push),r.shift=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.shift),r.unshift=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.unshift),r.sort=function(n){return function(){n.apply(this,u.call(arguments)),this.notify()}}(r.sort),r.splice=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.splice),arguments.length&&r.notify(),r};return r=n.object.mixin({},i.interfce,t.interfce)}(n,t,r),i=function(n,t,i,r){var u,f=t(),e=!1;return f.pushProperty=function(n){this.length?e&&this.peek().owner!==n.owner||this.push(n):this.push(n)},f.addDependency=function(n){this.length&&(e&&this.peek().owner!==n.owner||this.peek().dependencies().add(n))},u=function(e){var y=!1,c=t(),a=[],v,l,s,h,o,p=function(){s=undefined,h.notify()};return c.add=function(n){this.contains(n)||(this.push(n),a.push(n.subscribe(p)))},h={equals:function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t===n},changed:function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t!==n},get:function(){y||(f.addDependency(this),f.pushProperty(this));var n=s===undefined?l.call(this.owner):s;return s=n,f[f.length-1]===this&&f.pop(),n},set:function(n){typeof v=="function"&&(y=!0,(!this.equals(n)||this.changed(n))&&(s=undefined,v.call(this.owner,n),this.notify()),y=!1)},dependencies:function(){return c},isDependent:function(){return c.length!==0},toString:function(){return n.object.toString(this.get())},valueOf:function(){var t=this.get();return n.object.isNil(t)?t:t.valueOf()}},n.object.mixin(h,i()),function(){var f,s=h,b=!1,k=n.object.isObject,y=n.object.isArray,w=n.object.adheresTo;s.owner=undefined,typeof e=="function"?l=e:k(e)&&(typeof e.get=="function"||typeof e.set=="function")?(b=e.lazy,l=e.get,v=typeof e.set=="function"?e.set:null,s.equals=typeof e.equals=="function"?e.equals:s.equals,s.changed=typeof e.changed=="function"?e.changed:s.changed,s.owner=e.owner):(k(e)?(s.equals=typeof e.equals=="function"?e.equals:s.equals,s.changed=typeof e.changed=="function"?e.changed:s.changed,f=e.value,s.owner=e.owner):f=e,y(f)&&!w(f,i.interfce)&&(f=r(f),f.getItemOperators=function(n,t){return function(){return{equals:n,changed:t}}}(s.equals,s.changed),s.equals=function(n){return n=u.get(n),f.equals(n)},s.changed=function(n){return n=u.get(n),f.changed(n)}),f&&typeof f.subscribe=="function"&&typeof f.dispose=="function"&&a.push(f.subscribe(p)),l=function(){return f},v=function(n){if(w(f,t.interfce))f.clear(),y(n)?f.push.apply(f,n):f.push(n);else if(y(f)){while(f.length)f.pop();y(n)?f.push.apply(f,n):f.push(n)}else f!==n&&(f=n)}),s.dispose=function(n){return function(){while(a.length)a.pop().dispose();while(c.length)c.pop();n.call(this)}}(s.dispose),b||s.get(),o=function(n){var t,i=o.owner;return o.owner=this,arguments.length?(o.set(n),t=this):t=o.get(),o.owner=i,t},n.object.mixin(o,h)}(),o},u.get=function(n){return n&&typeof n.get=="function"?n.get():n},u.interfce=n.object.mixin({owner:"*",get:"function",set:"function",equals:"function",changed:"function"},i.interfce),u}(n,t,r,u),f=function(n,t){var i=function(i,r,u){var o=t.interfce,e=[],f;u=u||"twoway",u=n.string.toString(u),u=u.toLowerCase();if(!n.object.adheresTo(i,o))throw new Error("Binding source must be a observable property. "+i);if(!n.object.adheresTo(r,o))throw new Error("Binding sink must be a observable property. "+r);r.set(i.get());switch(u){case"oneway":f=i.subscribe(function(){r.set(i.get())}),e.push(f);break;case"twoway":f=i.subscribe(function(){r.set(i.get())}),e.push(f),f=r.subscribe(function(){i.set(r.get())}),e.push(f)}return f=null,{type:function(){return u},source:function(){return i},sink:function(){return r},dispose:function(){while(e.length)e.pop().dispose()}}};return i.interfce={type:"function",source:"function",sink:"function",dispose:"function"},i}(n,i),o=function(n,t,i,r){var u=function(){var n={};return r('script[type="text/html"][id]').each(function(){var t=r(this),u=t.attr("id"),i=t.text();n[u]=i}),n},o=function(n){var i=n.indexOf(">"),t=n.lastIndexOf("<");return n.substring(i+1,t)},e=function(f,e,o){var y=f?r(f):r("body"),h=/\{\{.+\}\}/,c=[],l=[],s=u(),v=function(r){var l=r.prop("nodeName").toLowerCase(),c=r.attr("type"),f,u;switch(l){case"input":switch(c){case"button":case"submit":case"reset":f=r.val(),f.search(h)<0||(u=t(function(){return o(f,e,s)}),u.subscribe(function(){var n=u.get();r.val(n?n.toString():"")}));break;case"checkbox":case"radio":f=r.attr("data-checked"),r.removeAttr("data-checked"),f.search(h)<0||(u=t(function(){return o(f,e,s)}),u.subscribe(function(){var f=u.dependencies(),t;f.length===1&&(t=f[0],typeof t=="function"?r.attr("checked",Boolean(t())):n.object.adheresTo(t,i.interfce)&&r.attr("checked",t.indexOf(r.val())>=0))}),r.bind("change.binding",function(){var f=u.dependencies(),t,e;f.length===1&&(t=f[0],u.block(),typeof t=="function"?t(r.attr("checked")):n.object.adheresTo(t,i.interfce)&&(r.attr("checked")?t.push(r.val()):t.remove(r.val())),u.unblock())}));break;case"hidden":f=r.val(),f.search(h)<0||(u=t(function(){return o(f,e,s)}),u.subscribe(function(){r.val(u.get())}))}break;case"button":f=r.text(),f.search(h)<0||(u=t(function(){return o(f,e,s)}),u.subscribe(function(){r.text(u.get())}));break;default:f=r.text(),f.search(h)<0||(u=t(function(){return o(f,e,s)}),u.subscribe(function(){r.text(u.get())}),(r.attr("contenteditable")||r.attr("data-contenteditable"))&&r.bind("blur.binding",function(){var f=u.dependencies(),t;f.length===1&&r.attr("contenteditable")&&(t=f[0],u.block(),typeof t=="function"?t(r.text()):n.object.adheresTo(t,i.interfce)&&(t.clear(),t.push(r.text())),u.unblock())}))}return u},p=function(n){var u,i,r,c=[],f=n[0],l=["data-checked","data-enabled","data-disabled","data-contenteditable","data-visible"],y=function(n,i,r){var u;return n&&n.search(h)>=0&&(u=t(function(){return o(n,e,s)}),u.subscribe(function(){r.attr(i,u.get())})),u},p=function(n,i,r){var u;return n&&n.search(h)>=0&&(u=t(function(){return o(n,e,s)}),u.subscribe(function(){var n=u.get();r.attr(i,n!=="false")})),u},a=function(n,i){var r;return n&&n.search(h)>=0&&(r=t(function(){return o(n,e,s)}),r.subscribe(function(){var n=r.get();i.attr("disabled",!n||n==="false")})),r},v=function(n,i){var r;return n&&n.search(h)>=0&&(r=t(function(){return o(n,e,s)}),r.subscribe(function(){var n=Boolean(r.get());n?i.show():i.hide()})),r};for(u in f)f.hasOwnProperty(u)&&(r=null,i=f[u],i=i&&typeof i.toString=="function"?i.toString():"",r=y(i,u,n),r&&c.push(r));while(l.length){r=null,u=l.pop(),i=n.attr(u),i=i&&typeof i.toString=="function"?i.toString():"";switch(u){case"enable":r=a(i,n);break;case"disabled":case"checked":case"contenteditable":r=p(i,u.replace(/^data-/,""),n);break;case"visible":r=v(i,n)}r&&(c.push(r),n.removeAttr(u))}return c},a=function(n){var r=n.text(),i;return r.search(h)<0||(i=t(function(){return o(r,e,s)}),i.subscribe(function(){n.replaceWith(i.get())})),i};return r("*",y).each(function(){var n=r(this);(function(){var i=n[0].firstChild,u,t,s=/\{\{(#|^)(.+?)\}\}/,h=/\{\{\/(.+?)\}\}/,l,f,e,o;t=v(n);if(t)c.push(t);else while(i)u=r(i),i.nodeType===3&&(t=a(u),t&&c.push(t)),i=i.nextSibling})()}),{refresh:function(){for(var t=c.length,n=0;n<t;n+=1)c[n].notify();for(n=0;n<t;n+=1)l[n].refresh()},dispose:function(){while(c.length)c.pop().dispose();while(l.length)l.pop().dispose();e=null,o=null,s=null}}},f=function(i,f,e){var l=i?r(i):r("body"),h=u(),s=[],c={};return function(){var i,r=function(i,r,u){var f=u;return n.object.adheresTo(u,t.interfce)&&(f=function(){var n=arguments;if(n.length)u.call(i,n[0]);else return u.call(i)}),f};for(i in f)f.hasOwnProperty(i)&&(c[i]=r(f,i,f[i]))}(),l.each(function(){var i=r(this),u=o(i.html()),n=t(function(){return e(u,f,h)});n.subscribe(function(){i.html(n.get())}),n.dispose=function(t){return function(){t.call(this),i=null,n=null,u=null}}(n.dispose),s.push(n)}),{refresh:function(){for(var t,i=s.length,n=0;n<i;n+=1)t=s[n],t.notify()},dispose:function(){while(s.length)s.pop().dispose();f=null,e=null,h=null}}};return{makeRenderEngine:f,makeRenderEngine2:e}}(n,i,t,jQuery);return{util:n,makeList:t,makeObservable:r,makeObservableList:u,makeProperty:i,makeBinding:f,templating:o,toObject:function(t,r){var e,h,o,f,u={},s=n.toObject,a=n.object.isObject,v=n.object.isArray,c=n.object.adheresTo,l=i.interfce;if(v(t)){for(h=t.length,u=[],e=0;e<h;e+=1)u.push(s(t[e]));return u}if(!a(t))return t;for(o in t)f=t[o],c(f,l)?f.isDependent()&&r||(u[o]=s(f.get())):u[o]=f;return u}}}()