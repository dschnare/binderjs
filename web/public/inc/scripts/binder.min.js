/*
Author: Darren Schnare
Keywords: javascript,binding,bind,property,list,observer,observable
License: MIT ( http://www.opensource.org/licenses/mit-license.php )
Repo: https://github.com/dschnare/binderjs
*/
var BINDER=function(n){"use strict";var t=function(n){var o=[].constructor,s={}.constructor,t=function(n){var u=[].constructor,r={equals:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,n===t},changed:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,!1}},i=function(t,i,r,u,f){return{status:t,item:i,value:i,index:r,otherItem:u,otherIndex:f,toString:function(){var e="{status: {0}, item: {1}, index: {2}, otherItem: {3}, otherIndex: {4}}";return n.format(e,t,i,r,u,f)}}},t=function(u){var f=[];return f.getItemOperators=function(){return n.create(r)},f.indexOf=f.indexOf||function(n,t){var i,r=this.length;t=isNaN(t)?0:t;if(r===0)return-1;if(t>=r)return-1;for(t<0&&(t=r+t),t<0&&(t=0),i=t;i<r;i+=1)if(this[i]===n)return i;return-1},f.lastIndexOf=f.lastIndexOf||function(n,t){var i,r=this.length,u=function(n,t){return n<t?n:t};if(r===0)return-1;for(t=isNaN(t)?r:t,t<0||(t=u(t,r-1)),t<0&&(t=r+t),i=t;i>=0;i-=1)if(this[i]===n)return n=null,i;return n=null,-1},f.reverse=f.reverse||function(){var n=0,r=this.length,t=r-1,u=parseInt((r/2).toFixed(0),10),i;while(n<u)i=this[t],this[t]=this[n],this[n]=i,t-=1,n+=1;return this},f.map=f.map||function(n,t){var i=0,u=this.length,r=[];r.length=u;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<u;i+=1)this.hasOwnProperty(i)&&(r[i]=n.call(t,this[i],i,this));return r},f.filter=f.filter||function(n,t){var i,r,f=this.length,u=[];if(typeof n!="function")throw new Error("TypeError");for(i=0;i<f;i+=1)this.hasOwnProperty(i)&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u},f.forEach=f.forEach||function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)this.hasOwnProperty(i)&&n.call(t,this[i],i,this)},f.reduce=f.reduce||function(n,t){var f=this.length,i=0,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1,i=0;while(!r&&i<f)r=this.hasOwnProperty(i),r&&(u=this[i]),i+=1}while(i<f)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i+=1;return u},f.reduceRight=f.reduceRight||function(n,t){var f=this.length,i=f-1,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1;while(!r&&i>=0)r=this.hasOwnProperty(i),r&&(u=this[i]),i-=1}while(i>=0)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i-=1;return u},f.some=f.some||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return!0;return!1},f.every=f.every||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(!n.call(t,this[i],i,this))return!1;return!0},f.contains=function(n){return this.indexOf(n)>=0},f.occurances=function(n){var t=this.indexOf(n),i=0;while(t>=0)i+=1,t=this.indexOf(n,t+1);return i},f.distinct=function(){var t=this.length,i=[],n;while(t)t-=1,n=this[t],this.occurances(n)===1&&i.unshift(n);return i},f.first=function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i];return undefined},f.last=function(n,t){var i=this.length;if(typeof n!="function")throw new Error("TypeError");while(i){i-=1;if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i]}return undefined},f.find=function(n,t,i){var r,u=this.length;if(typeof n!="function")throw new Error("TypeError");for(typeof t=="number"||i||(i=t),(isNaN(t)||t<0)&&(t=0),r=t;r<u;r+=1)if(this.hasOwnProperty(r))if(n.call(i,this[r],r,this))return{item:this[r],index:r};return{item:undefined,index:-1}},f.equals=function(i,r){var u,s,h,f=this,e=i,o;if(!n.isArray(i))return!1;if(f===e)return!0;if(f.length!==e.length)return!1;for(s=f.length,h=e.length,o=t.getItemOperators(this),r=typeof r=="function"?r:function(){return o.equals.apply(o,arguments)},u=0;u<s&&u<h;u+=1)if(!r(f[u],e[u]))return!1;return!0},f.changed=function(i,r,u){var f,h,c,e=this,o=i,s;if(!n.isArray(i))return!1;if(e===o)return!1;if(e.length!==o.length)return!0;for(s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},h=e.length,c=o.length,f=0;f<h&&f<c;f+=1)if(!r(e[f],o[f])||u(e[f],o[f]))return!0;return!1},f.compare=function(n,r,u){var s,h=t(),f,c,e,a=this.find,l,o;for(n=t(n),s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},l=function(n){return r(e,n)},c=this.length,f=0;f<c;f+=1)e=this[f],o=a.call(n,l),o.index<0?h.push(i("deleted",e,f)):(u(e,o.item)?h.push(i("changed",e,f,o.item,o.index)):h.push(i("retained",e,f,o.item,o.index)),delete n[o.index]);for(c=n.length,f=0;f<c;f+=1)n.hasOwnProperty(f)&&(e=n[f],this.find(l).index<0&&h.push(i("added",undefined,-1,e,f)));return e=n=r=u=null,h},f.merge=function(n,i,r){var u=t(this);return u.mergeWith(n,i,r),u},f.mergeWith=function(n,i,r){var f,o,e,u;f=t.getItemOperators(this),o=this.compare(n,i,r),e=o.length,this.length=n.length;while(e){e-=1,u=o[e];switch(u.status){case"added":this[u.otherIndex]=u.otherItem;break;case"deleted":f.equals(this[u.index],u.item)&&(this[u.index]=undefined);break;case"changed":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.otherItem;break;case"retained":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.item}}this.collapse()},f.remove=function(){for(var n,i,r=arguments.length,t=0;t<r;t+=1){i=arguments[t],n=this.length;while(n)n-=1,this[n]===i&&this.splice(n,1)}},f.removeAt=function(n){if(isFinite(n)&&n>=0&&n<this.length)return this.splice(n,1).pop()},f.clear=function(){while(this.length)this.pop()},f.collapse=function(){var n=this.length;while(n)n-=1,this[n]===undefined&&this.splice(n,1)},f.replaceAt=function(n,t){var i;return isFinite(n)&&n>=0&&n<this.length&&(i=this[n],this[n]=t),i},f.isEmpty=function(){return this.length===0},f.peek=function(){return this[this.length-1]},f.insert=function(n,t){return n>this.length+1?n=this.length+1:n<0&&(n=0),n>=0?(n===this.length+1?this.push(t):this.hasOwnProperty(n)?this.splice(n,0,t):this[n]=t,!0):!1},function(t){var i=t.length;i===1&&n.isArray(u)?f.push.apply(f,u):i&&f.push.apply(f,f.slice.call(t))}(arguments),f};return t.getItemOperators=function(n){var t=n.getItemOperators();return typeof t.equals!="function"&&(t.equals=r.equals),typeof t.changed!="function"&&(t.changed=r.changed),t},t.interfce={concat:"function",indexOf:"function",join:"function",lastIndexOf:"function",map:"function",filter:"function",forEach:"function",reduce:"function",reduceRight:"function",reverse:"function",some:"function",shift:"function",slice:"function",sort:"function",splice:"function",every:"function",pop:"function",push:"function",unshift:"function",toString:"function",contains:"function",occurances:"function",distinct:"function",first:"function",last:"function",find:"function",equals:"function",changed:"function",compare:"function",merge:"function",mergeWith:"function",remove:"function",removeAt:"function",clear:"function",collapse:"function",replaceAt:"function",isEmpty:"function",peek:"function",insert:"function"},t}(n),u=function(n,t){var r=function(n,t){for(var i,u=t.length,r=0;r<u;r+=1){i=t[r];if(i)if(typeof i=="function")i(n);else if(typeof i.onNotify=="function")i.onNotify(n)}},i=function(){var i=n(),e=0,u=!1,f=[],o=-1;return{block:function(){f.push(!0)},unblock:function(){f.pop()},subscribe:function(n){return n&&!i.contains(n)?(i.push(n),{dispose:function(){i.remove(n)}}):{dispose:function(){}}},throttle:function(n){isFinite(n)||(n=0),e=n},notify:function(){var n=this;if(f.length||u)return;u=!0,e>0?o=t(function(){r(n,i),u=!1},e):(r(n,i),u=!1)},dispose:function(){i.clear(),clearTimeout(o)}}};return i.interfce={block:"function",unblock:"function",subscribe:"function",throttle:"function",notify:"function",dispose:"function"},i}(t,setTimeout),f=function(n,t,i){var r=function(){var u=[].slice,r=t.apply(undefined,u.call(arguments));return n.mixin(r,i()),r.remove=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.remove),r.removeAt=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.removeAt),r.replaceAt=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),this.notify(),t}}(r.replaceAt),r.clear=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.clear),r.collapse=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.collapse),r.insert=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),t&&this.notify(),t}}(r.insert),r.mergeWith=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),this.notify(),t}}(r.mergeWith),r.reverse=function(n){return function(){var t;return this.block(),t=n.call(this),this.unblock(),this.notify(),t}}(r.reverse),r.pop=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.pop),r.push=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.push),r.shift=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.shift),r.unshift=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.unshift),r.sort=function(n){return function(){var t=n.apply(this,u.call(arguments));return this.notify(),t}}(r.sort),r.splice=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.splice),r};return r.interfce=n.mixin({},i.interfce,t.interfce),r}(n,t,u),r=function(n,t,i,r){var u,f=t(),e=!1;return f.pushProperty=function(n){this.length?e&&this.peek().owner!==n.owner||this.push(n):this.push(n)},f.addDependency=function(n){this.length&&(e&&this.peek().owner!==n.owner||this.peek().dependencies().add(n))},u=function(e){var v=!1,h=t(),l=[],a,c,s,o,y=function(){s=undefined,o.notify()};return h.add=function(n){this.contains(n)||(this.push(n),l.push(n.subscribe(y)))},o=function(n){var t,i=o.owner;return this!==undefined&&(o.owner=this),arguments.length?(o.set(n),t=this):t=o.get(),o.owner=i,t},o.equals=function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t===n},o.changed=function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t!==n},o.clearMemo=function(){s=undefined},o.get=function(){v||(f.addDependency(this),f.pushProperty(this));var n=s===undefined?c.call(this.owner):s;return s=n,f[f.length-1]===this&&f.pop(),n},o.set=function(n){typeof a=="function"&&(v=!0,(!this.equals(n)||this.changed(n))&&(this.block(),a.call(this.owner,n),s=undefined,this.unblock(),this.notify()),v=!1)},o.dependencies=function(){return h},o.isDependent=function(){return h.length!==0},o.toString=function(){return n.str(this.get())},o.valueOf=function(){var t=this.get();return n.isNil(t)?t:t.valueOf()},n.mixin(o,i()),function(){var f,s=o,w=!1,b=n.isObject,v=n.isArray,p=n.adheresTo;s.owner=undefined,typeof e=="function"?c=e:b(e)&&typeof e.get=="function"?(w=e.lazy,c=e.get,a=typeof e.set=="function"?e.set:null,s.equals=typeof e.equals=="function"?e.equals:s.equals,s.changed=typeof e.changed=="function"?e.changed:s.changed,s.owner=e.owner):(b(e)?(s.equals=typeof e.equals=="function"?e.equals:s.equals,s.changed=typeof e.changed=="function"?e.changed:s.changed,f=e.value):f=e,v(f)&&!p(f,i.interfce)&&(f=r(f),f.getItemOperators=function(n,t,i){return n=typeof n=="function"?n:i.equals,t=typeof t=="function"?t:i.changed,function(){return{equals:n,changed:t}}}(e.equals,e.changed,t.getItemOperators(f)),s.equals=function(n){return n=u.get(n),f.equals(n)},s.changed=function(n){return n=u.get(n),f.changed(n)}),f&&typeof f.subscribe=="function"&&typeof f.dispose=="function"&&l.push(f.subscribe(y)),c=function(){return f},a=function(n){if(p(f,t.interfce))f.clear(),v(n)?f.push.apply(f,n):f.push(n);else if(v(f)){while(f.length)f.pop();v(n)?f.push.apply(f,n):f.push(n)}else f!==n&&(f=n)}),s.dispose=function(n){return function(){while(l.length)l.pop().dispose();while(h.length)h.pop();n.call(this)}}(s.dispose),w||o.get()}(),o},u.get=function(n){return n&&typeof n.get=="function"?n.get():n},u.interfce=n.mixin({owner:"*",dependencies:"function",isDependent:"function",clearMemo:"function",get:"function",set:"function",equals:"function",changed:"function"},i.interfce),u}(n,t,u,f),e=function(n,t){var i=function(i,r,u){var o=t.interfce,e=[],f;u=u||"twoway",u=n.str(u),u=u.toLowerCase();if(!n.adheresTo(i,o))throw new Error("Binding source must be an observable property. "+i);if(!n.adheresTo(r,o))throw new Error("Binding sink must be an observable property. "+r);r.set(i.get());switch(u){case"oneway":f=i.subscribe(function(){r.set(i.get())}),e.push(f);break;case"twoway":f=i.subscribe(function(){r.set(i.get())}),e.push(f),f=r.subscribe(function(){i.set(r.get())}),e.push(f)}return f=null,{type:function(){return u},source:function(){return i},sink:function(){return r},dispose:function(){while(e.length)e.pop().dispose()}}};return i.interfce={type:"function",source:"function",sink:"function",dispose:"function"},i}(n,r),i=function(t,u){var s,h,o,e,f={},a=n.isObject,v=n.isArray,c=n.adheresTo,l=r.interfce;if(v(t)){for(h=t.length,f=[],s=0;s<h;s+=1)f.push(i(t[s]));return f}if(!a(t))return t;for(o in t)t[o]!==undefined&&(e=t[o],c(e,l)?e.isDependent()&&u||(f[o]=i(e.get())):f[o]=e);return f};return{utiljs:n,makeList:t,makeObservable:u,makeObservableList:f,makeProperty:r,makeBinding:e,toObject:i}};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(["utiljs"],t);else if(typeof exports=="object"&&exports&&typeof require=="function")n=require("utiljs"),n.mixin(exports,t(n));else return t(n)}(typeof UTIL=="object"&&UTIL?UTIL:null)