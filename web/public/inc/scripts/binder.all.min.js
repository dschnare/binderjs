/*
Author: Darren Schnare
Keywords: javascript,binding,bind,property,list,observer,observable
License: MIT ( http://www.opensource.org/licenses/mit-license.php )
Repo: https://github.com/dschnare/binderjs
*/
var BINDER=function(){"use strict";var h=[].constructor,c={}.constructor,n=function(){var t=null,n=null,r=null;return function(){var h={}.constructor,s=function(n){return n===null||n===undefined},f=function(){var n=h.prototype.toString;return function(t){return n.call(t)==="[object Array]"||!s(t)&&typeof t.length=="number"&&typeof t.push=="function"}}(),i=function(n){return n===null?"null":f(n)?"array":typeof n},o=function(n){return n&&i(n)==="object"},e=function(n){return n===undefined||n===null?"":n.toString()},c=function(n){var u=arguments.length,r,t,i;if(u===0||!n)throw new Error("Expected at least one object as an argument.");for(r=1;r<u;r+=1){t=arguments[r];if(!s(t))for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i])}return n},u={typeOf:i,isObject:o,isArray:f,isNil:s,mixin:c,str:e,respondsTo:function(n,t){return n&&typeof n[t]=="function"},adheresTo:function(n,t){var r,s,u;if((o(n)||typeof n=="function"||f(n))&&(o(t)||typeof t=="function"||f(t))){for(r in t)if(t.hasOwnProperty(r))if(t[r]==="*"){if(!n.hasOwnProperty(r))return!1}else if(i(n[r])!==i(t[r])&&i(n[r])!==e(t[r]))return!1;return!0}return s=i(n),u=i(t),s===u},create:function(){var n=function(){};return function(t){if(!t)throw new Error("Expected an object as an argument.");return n.prototype=t,new n}}(),trim:function(n){n=n?n.toString():"";var t=0,i=n.charAt(t);while(i){if(i>" "){n=n.substring(t);break}t+=1,i=n.charAt(t)}t=n.length;while(t){t-=1,i=n.charAt(t);if(i>" "){n=n.substring(0,t+1);break}}return n},format:function(n){var r=e(n),s=arguments,h=s.length,u=r.length,i=null,t=0,o=0,f=function(){return u-=1,i=r.charAt(u)};while(f())if(i==="}"){o=u+1,f(),t="";while(i>="0"&&i<="9")t=i+t,f();i==="{"&&(t=parseInt(t,10)+1,t<h&&(r=r.substring(0,u)+s[t]+r.substring(o)))}return r}};if(typeof t=="function"&&typeof t.amd=="object")t(u);else if(n&&typeof n=="object"&&typeof r=="function")u.mixin(n,u);else return u}()}(),t=function(n){var u=[].constructor,r={equals:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,n===t},changed:function(n,t){return n=n?n.valueOf():n,t=t?t.valueOf():t,n!==t}},i=function(t,i,r,u,f){return{status:t,item:i,value:i,index:r,otherItem:u,otherIndex:f,toString:function(){var e="{status: {0}, item: {1}, index: {2}, otherItem: {3}, otherIndex: {4}}";return n.format(e,t,i,r,u,f)}}},t=function(u){var f=[];return f.getItemOperators=function(){return n.create(r)},f.indexOf=f.indexOf||function(n,t){var i,r=this.length;t=isNaN(t)?0:t;if(r===0)return-1;if(t>=r)return-1;for(t<0&&(t=r+t),t<0&&(t=0),i=t;i<r;i+=1)if(this[i]===n)return i;return-1},f.lastIndexOf=f.lastIndexOf||function(n,t){var i,r=this.length,u=function(n,t){return n<t?n:t};if(r===0)return-1;for(t=isNaN(t)?r:t,t<0||(t=u(t,r-1)),t<0&&(t=r+t),i=t;i>=0;i-=1)if(this[i]===n)return n=null,i;return n=null,-1},f.reverse=f.reverse||function(){var n=0,r=this.length,t=r-1,u=parseInt((r/2).toFixed(0),10),i;while(n<u)i=this[t],this[t]=this[n],this[n]=i,t-=1,n+=1;return this},f.map=f.map||function(n,t){var i=0,u=this.length,r=[];r.length=u;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<u;i+=1)this.hasOwnProperty(i)&&(r[i]=n.call(t,this[i],i,this));return r},f.filter=f.filter||function(n,t){var i,r,f=this.length,u=[];if(typeof n!="function")throw new Error("TypeError");for(i=0;i<f;i+=1)this.hasOwnProperty(i)&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u},f.forEach=f.forEach||function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)this.hasOwnProperty(i)&&n.call(t,this[i],i,this)},f.reduce=f.reduce||function(n,t){var f=this.length,i=0,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1,i=0;while(!r&&i<f)r=this.hasOwnProperty(i),r&&(u=this[i]),i+=1}while(i<f)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i+=1;return u},f.reduceRight=f.reduceRight||function(n,t){var f=this.length,i=f-1,u,r;if(typeof n!="function")throw new Error("TypeError");if(f===0&&arguments.length===1)throw new Error("TypeError");if(arguments.length===2)u=t;else{r=!1;while(!r&&i>=0)r=this.hasOwnProperty(i),r&&(u=this[i]),i-=1}while(i>=0)r=this.hasOwnProperty(i),r&&(u=n.call(undefined,u,this[i],i,this)),i-=1;return u},f.some=f.some||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return!0;return!1},f.every=f.every||function(n,t){var r=this.length,i;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(!n.call(t,this[i],i,this))return!1;return!0},f.contains=function(n){return this.indexOf(n)>=0},f.occurances=function(n){var t=this.indexOf(n),i=0;while(t>=0)i+=1,t=this.indexOf(n,t+1);return i},f.distinct=function(){var t=this.length,i=[],n;while(t)t-=1,n=this[t],this.occurances(n)===1&&i.unshift(n);return i},f.first=function(n,t){var i,r=this.length;if(typeof n!="function")throw new Error("TypeError");for(i=0;i<r;i+=1)if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i];return undefined},f.last=function(n,t){var i=this.length;if(typeof n!="function")throw new Error("TypeError");while(i){i-=1;if(this.hasOwnProperty(i))if(n.call(t,this[i],i,this))return this[i]}return undefined},f.find=function(n,t,i){var r,u=this.length;if(typeof n!="function")throw new Error("TypeError");for(typeof t=="number"||i||(i=t),(isNaN(t)||t<0)&&(t=0),r=t;r<u;r+=1)if(this.hasOwnProperty(r))if(n.call(i,this[r],r,this))return{item:this[r],index:r};return{item:undefined,index:-1}},f.equals=function(i,r){var u,s,h,f=this,e=i,o;if(!n.isArray(i))return!1;if(f===e)return!0;if(f.length!==e.length)return!1;for(s=f.length,h=e.length,o=t.getItemOperators(this),r=typeof r=="function"?r:function(){return o.equals.apply(o,arguments)},u=0;u<s&&u<h;u+=1)if(!r(f[u],e[u]))return!1;return!0},f.changed=function(i,r,u){var f,h,c,e=this,o=i,s;if(!n.isArray(i))return!1;if(e===o)return!1;if(e.length!==o.length)return!0;for(s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},h=e.length,c=o.length,f=0;f<h&&f<c;f+=1)if(!r(e[f],o[f])||u(e[f],o[f]))return!0;return!1},f.compare=function(n,r,u){var s,h=t(),f,c,e,a=this.find,l,o;for(n=t(n),s=t.getItemOperators(this),r=typeof r=="function"?r:function(){return s.equals.apply(s,arguments)},u=typeof u=="function"?u:function(){return s.changed.apply(s,arguments)},l=function(n){return r(e,n)},c=this.length,f=0;f<c;f+=1)e=this[f],o=a.call(n,l),o.index<0?h.push(i("deleted",e,f)):(u(e,o.item)?h.push(i("changed",e,f,o.item,o.index)):h.push(i("retained",e,f,o.item,o.index)),delete n[o.index]);for(c=n.length,f=0;f<c;f+=1)n.hasOwnProperty(f)&&(e=n[f],this.find(l).index<0&&h.push(i("added",undefined,-1,e,f)));return e=n=r=u=null,h},f.merge=function(n,i,r){var u=t(this);return u.mergeWith(n,i,r),u},f.mergeWith=function(n,i,r){var f,o,e,u;f=t.getItemOperators(this),o=this.compare(n,i,r),e=o.length,this.length=n.length;while(e){e-=1,u=o[e];switch(u.status){case"added":this[u.otherIndex]=u.otherItem;break;case"deleted":f.equals(this[u.index],u.item)&&(this[u.index]=undefined);break;case"changed":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.otherItem;break;case"retained":f.equals(this[u.index],u.item)&&(this[u.index]=undefined),this[u.otherIndex]=u.item}}this.collapse()},f.remove=function(){for(var n,i,r=arguments.length,t=0;t<r;t+=1){i=arguments[t],n=this.length;while(n)n-=1,this[n]===i&&this.splice(n,1)}},f.removeAt=function(n){if(isFinite(n)&&n>=0&&n<this.length)return this.splice(n,1).pop()},f.clear=function(){while(this.length)this.pop()},f.collapse=function(){var n=this.length;while(n)n-=1,this[n]===undefined&&this.splice(n,1)},f.replaceAt=function(n,t){var i;return isFinite(n)&&n>=0&&n<this.length&&(i=this[n],this[n]=t),i},f.isEmpty=function(){return this.length===0},f.peek=function(){return this[this.length-1]},f.insert=function(n,t){return n>this.length+1?n=this.length+1:n<0&&(n=0),n>=0?(n===this.length+1?this.push(t):this.hasOwnProperty(n)?this.splice(n,0,t):this[n]=t,!0):!1},function(t){var i=t.length;i===1&&n.isArray(u)?f.push.apply(f,u):i&&f.push.apply(f,f.slice.call(t))}(arguments),f};return t.getItemOperators=function(n){var t=n.getItemOperators();return typeof t.equals!="function"&&(t.equals=r.equals),typeof t.changed!="function"&&(t.changed=r.changed),t},t.interfce={concat:"function",indexOf:"function",join:"function",lastIndexOf:"function",map:"function",filter:"function",forEach:"function",reduce:"function",reduceRight:"function",reverse:"function",some:"function",shift:"function",slice:"function",sort:"function",splice:"function",every:"function",pop:"function",push:"function",unshift:"function",toString:"function",contains:"function",occurances:"function",distinct:"function",first:"function",last:"function",find:"function",equals:"function",changed:"function",compare:"function",merge:"function",mergeWith:"function",remove:"function",removeAt:"function",clear:"function",collapse:"function",replaceAt:"function",isEmpty:"function",peek:"function",insert:"function"},t}(n),r=function(n,t){var r=function(n,t){for(var i,u=t.length,r=0;r<u;r+=1){i=t[r];if(i)if(typeof i=="function")i(n);else if(typeof i.onNotify=="function")i.onNotify(n)}},i=function(){var i=n(),e=0,u=!1,f=[],o=-1;return{block:function(){f.push(!0)},unblock:function(){f.pop()},subscribe:function(n){return n&&!i.contains(n)?(i.push(n),{dispose:function(){i.remove(n)}}):{dispose:function(){}}},throttle:function(n){isFinite(n)||(n=0),e=n},notify:function(){var n=this;if(f.length||u)return;u=!0,e>0?o=t(function(){r(n,i),u=!1},e):(r(n,i),u=!1)},dispose:function(){i.clear(),clearTimeout(o)}}};return i.interfce={block:"function",unblock:"function",subscribe:"function",throttle:"function",notify:"function",dispose:"function"},i}(t,setTimeout),f=function(n,t,i){var r=function(){var u=[].slice,r=t.apply(undefined,u.call(arguments));return n.mixin(r,i()),r.remove=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.remove),r.removeAt=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.removeAt),r.replaceAt=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),this.notify(),t}}(r.replaceAt),r.clear=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.clear),r.collapse=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.collapse),r.insert=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),t&&this.notify(),t}}(r.insert),r.mergeWith=function(n){return function(){var t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),this.notify(),t}}(r.mergeWith),r.reverse=function(n){return function(){var t;return this.block(),t=n.call(this),this.unblock(),this.notify(),t}}(r.reverse),r.pop=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.pop),r.push=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.push),r.shift=function(n){return function(){var i=this.length,t;return this.block(),t=n.call(this),this.unblock(),i!==this.length&&this.notify(),t}}(r.shift),r.unshift=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.unshift),r.sort=function(n){return function(){var t=n.apply(this,u.call(arguments));return this.notify(),t}}(r.sort),r.splice=function(n){return function(){var i=this.length,t;return this.block(),t=n.apply(this,u.call(arguments)),this.unblock(),i!==this.length&&this.notify(),t}}(r.splice),r};return r.interfce=n.mixin({},i.interfce,t.interfce),r}(n,t,r),i=function(n,t,i,r){var u,f=t(),e=!1;return f.pushProperty=function(n){this.length?e&&this.peek().owner!==n.owner||this.push(n):this.push(n)},f.addDependency=function(n){this.length&&(e&&this.peek().owner!==n.owner||this.peek().dependencies().add(n))},u=function(e,o,s){var p=!1,a=t(),y=[],l,v,c,h,w=function(){c=undefined,h.notify()};return a.add=function(n){this.contains(n)||(this.push(n),y.push(n.subscribe(w)))},h=function(n){var t,i=h.owner;return this!==undefined&&(h.owner=this),arguments.length?(h.set(n),t=this):t=h.get(),h.owner=i,t},h.equals=function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t===n},h.changed=function(n){var t=this.get();return n=u.get(n),t=t?t.valueOf():t,n=n?n.valueOf():n,t!==n},h.clearMemo=function(){c=undefined},h.get=function(){p||(f.addDependency(this),f.pushProperty(this));var n=c===undefined?v.call(this.owner):c;return c=n,f[f.length-1]===this&&f.pop(),n},h.set=function(n){typeof l=="function"&&(p=!0,(!this.equals(n)||this.changed(n))&&(this.block(),l.call(this.owner,n),c=undefined,this.unblock(),this.notify()),p=!1)},h.dependencies=function(){return a},h.isDependent=function(){return a.length!==0},h.toString=function(){return n.str(this.get())},h.valueOf=function(){var t=this.get();return n.isNil(t)?t:t.valueOf()},n.mixin(h,i()),function(){var f,c=h,k=!1,d=n.isObject,p=n.isArray,b=n.adheresTo;c.owner=undefined,typeof e=="function"?(v=e,l=typeof o=="function"?o:null,c.owner=typeof o=="function"?s:o):d(e)&&typeof e.get=="function"?(k=e.lazy,v=e.get,l=typeof e.set=="function"?e.set:null,c.equals=typeof e.equals=="function"?e.equals:c.equals,c.changed=typeof e.changed=="function"?e.changed:c.changed,c.owner=e.owner):(d(e)?(c.equals=typeof e.equals=="function"?e.equals:c.equals,c.changed=typeof e.changed=="function"?e.changed:c.changed,f=e.value):f=e,p(f)&&!b(f,i.interfce)&&(f=r(f),f.getItemOperators=function(n,t,i){return n=typeof n=="function"?n:i.equals,t=typeof t=="function"?t:i.changed,function(){return{equals:n,changed:t}}}(e.equals,e.changed,f.getItemOperators()),c.equals=function(n){return n=u.get(n),f.equals(n)},c.changed=function(n){return n=u.get(n),f.changed(n)}),f&&typeof f.subscribe=="function"&&typeof f.dispose=="function"&&y.push(f.subscribe(w)),v=function(){return f},l=function(n){if(b(f,t.interfce))f.clear(),p(n)?f.push.apply(f,n):f.push(n);else if(p(f)){while(f.length)f.pop();p(n)?f.push.apply(f,n):f.push(n)}else f!==n&&(f=n)}),c.dispose=function(n){return function(){while(y.length)y.pop().dispose();while(a.length)a.pop();n.call(this)}}(c.dispose),k||h.get()}(),h},u.get=function(n){return n&&typeof n.get=="function"?n.get():n},u.interfce=n.mixin({owner:"*",dependencies:"function",isDependent:"function",clearMemo:"function",get:"function",set:"function",equals:"function",changed:"function"},i.interfce),u}(n,t,r,f),o=function(n,t){var i=function(i,r,u){var o=t.interfce,e=[],f;u=u||"twoway",u=n.str(u),u=u.toLowerCase();if(!n.adheresTo(i,o))throw new Error("Binding source must be an observable property. "+i);if(!n.adheresTo(r,o))throw new Error("Binding sink must be an observable property. "+r);r.set(i.get());switch(u){case"oneway":f=i.subscribe(function(){r.set(i.get())}),e.push(f);break;case"twoway":f=i.subscribe(function(){r.set(i.get())}),e.push(f),f=r.subscribe(function(){i.set(r.get())}),e.push(f)}return f=null,{type:function(){return u},source:function(){return i},sink:function(){return r},dispose:function(){while(e.length)e.pop().dispose()}}};return i.interfce={type:"function",source:"function",sink:"function",dispose:"function"},i}(n,i),s=function(n,t,i){var r=function(u,f){var h,p,o,c,e,l,y={},w=n.isObject,b=n.isArray,k=n.adheresTo,d=t.interfce,g=function(n){return n},a,v,s;f=f||y,typeof f=="function"?s=f:(s=f.filter,s=typeof s=="function"?s:g);if(b(u))for(e=[],p=u.length,h=0;h<p;h+=1)e.push(r(u[h],f));else if(w(u)){e={},a=i(f.include||[]),v=i(f.exclude||[]);for(o in u)u[o]!==undefined&&(a.contains(o)||!v.contains(o))&&(c=u[o],l=f.properties?f.properties[o]:y,e[o]=k(c,d)?r(c.get(),l):r(c,l));e=s(e,u)}else e=s(u,u);return e};return r}(n,i,t),e=function(n,t,i){var r=function(u,f,e){var w=n.isArray,ut=n.isNil,rt=n.isObject,y=n.adheresTo,b=t.interfce,it={},nt,tt,d,v,a,k=function(n){return n},c,o,s,p,g,ft,h,l;f=f||it,typeof f=="function"?v=f:(v=f.filter,v=typeof v=="function"?v:k);if(w(u)){for(h=i(),g=u.length,p=0;p<g;p+=1)h.push(r(u[p],f));if(e)if(y(e,i.interfce))e.merge(h);else if(w(e))e.push.apply(e,h);else throw new Error("Expected target to be an Array.");}else if(rt(u)){h={},nt=i(f.include||[]),tt=i(f.exclude||[]),d=i(f.copy||[]);for(o in u)u[o]!==undefined&&typeof u[o]!="function"&&(c=f.properties?f.properties[o]:it,s=u[o],a=c?c.create:k,a=typeof a=="function"?a:k,s!==undefined&&(nt.contains(o)||!tt.contains(o))&&(d.contains(o)?e?y(e[o],b)?e[o](r(s,c)):e[o]=r(s,c):h[o]=r(s,c):w(s)?e?y(e[o],b)?e[o](r(s,c)):w(e[o])?r(s,c,e[o]):(l=t(a(r(s,c),e)),e[o]=l,l.owner=e):(l=t(a(r(s,c),h)),l.owner=h,h[o]=l):rt(s)?e?y(e[o],b)?e[o](r(s,c)):e[o]=r(s,c):h[o]=r(s,c):e?y(e[o],b)?e[o](r(s,c)):(l=t(a(r(s,c),e)),e[o]=l,l.owner=e):(l=t(a(r(s,c),h)),l.owner=h,h[o]=l)));h=v(h,u)}else h=v(u,u);return e||h};return r}(n,i,t),u={utiljs:n,makeList:t,makeObservable:r,makeObservableList:f,makeProperty:i,makeBinding:o,toJSON:s,fromJSON:e};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd)define(u);else if(typeof exports=="object"&&exports&&typeof require=="function")n.mixin(exports,u);else return u}()