/*
 Author: Darren Schnare
 Keywords: javascript,binding,bind,property,list,observer,observable
 License: MIT ( http://www.opensource.org/licenses/mit-license.php )
 Repo: https://github.com/dschnare/binderjs
*/
function m(v){throw v;}var r=void 0,t=!0,x=null,z=!1;
(function(){function v(n){function o(i,h,g){function e(a){return a}var f=n.isArray,c=n.isObject,d=n.adheresTo,b=w.interfce,a={},C,B,y,k,j,p,l,s,q,h=h||a;"function"===typeof h?k=h:(k=h.filter,k="function"===typeof k?k:e);if(f(i)){q=u();b=i.length;for(c=0;c<b;c+=1)q.push(o(i[c],h));g&&(d(g,u.interfce)?g.merge(q):f(g)?g.push.apply(g,q):m(Error("Expected target to be an Array.")))}else if(c(i)){q={};C=u(h.include||[]);B=u(h.exclude||[]);y=u(h.copy||[]);for(l in i)if(i[l]!==r&&"function"!==typeof i[l]&&
(p=h.properties?h.properties[l]:a,s=i[l],j=p?p.create:e,j="function"===typeof j?j:e,s!==r&&(C.contains(l)||!B.contains(l))))if(y.contains(l))if(g)if(d(g[l],b))g[l](o(s,p));else g[l]=o(s,p);else q[l]=o(s,p);else if(f(s))if(g)if(d(g[l],b))g[l](o(s,p));else f(g[l])?o(s,p,g[l]):(j=w(j(o(s,p),g)),g[l]=j,j.owner=g);else j=w(j(o(s,p),q)),j.owner=q,q[l]=j;else if(c(s))if(g)if(d(g[l],b))g[l](o(s,p));else g[l]=o(s,p);else q[l]=o(s,p);else if(g)if(d(g[l],b))g[l](o(s,p));else j=w(j(o(s,p),g)),g[l]=j,j.owner=
g;else j=w(j(o(s,p),q)),j.owner=q,q[l]=j;q=k(q,i)}else q=k(i,i);return g||q}function v(i,h){function g(a){return a}var e,f,c,d,b;f={};d=n.isObject;c=n.isArray;var a=n.adheresTo,C=w.interfce,B,y,k,h=h||f;"function"===typeof h?k=h:(k=h.filter,k="function"===typeof k?k:g);if(c(i)){d=[];f=i.length;for(e=0;e<f;e+=1)d.push(v(i[e],h))}else if(d(i)){d={};B=u(h.include||[]);y=u(h.exclude||[]);for(e in i)if(i[e]!==r&&(B.contains(e)||!y.contains(e)))c=i[e],b=h.properties?h.properties[e]:f,d[e]=a(c,C)?v(c.get(),
b):v(c,b);d=k(d,i)}else d=k(i,i);return d}var D=[].constructor,u=function(){function i(e){var f=[];f.getItemOperators=function(){return n.create(g)};f.indexOf=f.indexOf||function(c,d){var b,a=this.length,d=isNaN(d)?0:d;if(0===a||d>=a)return-1;0>d&&(d=a+d);0>d&&(d=0);for(b=d;b<a;b+=1)if(this[b]===c)return b;return-1};f.lastIndexOf=f.lastIndexOf||function(c,d){var b;b=this.length;if(0===b)return-1;d=isNaN(d)?b:d;0<=d&&(d=d<b-1?d:b-1);0>d&&(d=b+d);for(b=d;0<=b;b-=1)if(this[b]===c)return b;return-1};
f.reverse=f.reverse||function(){for(var c=0,d=this.length,b=d-1,d=parseInt((d/2).toFixed(0),10),a;c<d;)a=this[b],this[b]=this[c],this[c]=a,b-=1,c+=1;return this};f.map=f.map||function(c,d){var b=0,a=this.length,e=[];e.length=a;"function"!==typeof c&&m(Error("TypeError"));for(b=0;b<a;b+=1)this.hasOwnProperty(b)&&(e[b]=c.call(d,this[b],b,this));return e};f.filter=f.filter||function(c,d){var b,a,e=this.length,f=[];"function"!==typeof c&&m(Error("TypeError"));for(b=0;b<e;b+=1)this.hasOwnProperty(b)&&
(a=this[b],c.call(d,a,b,this)&&f.push(a));return f};f.forEach=f.forEach||function(c,d){var b,a=this.length;"function"!==typeof c&&m(Error("TypeError"));for(b=0;b<a;b+=1)this.hasOwnProperty(b)&&c.call(d,this[b],b,this)};f.reduce=f.reduce||function(c,d){var b=this.length,a=0,e,f;"function"!==typeof c&&m(Error("TypeError"));0===b&&1===arguments.length&&m(Error("TypeError"));if(2===arguments.length)e=d;else{f=z;for(a=0;!f&&a<b;)(f=this.hasOwnProperty(a))&&(e=this[a]),a+=1}for(;a<b;)(f=this.hasOwnProperty(a))&&
(e=c.call(r,e,this[a],a,this)),a+=1;return e};f.reduceRight=f.reduceRight||function(c,d){var b=this.length,a=b-1,e;"function"!==typeof c&&m(Error("TypeError"));0===b&&1===arguments.length&&m(Error("TypeError"));if(2===arguments.length)e=d;else for(b=z;!b&&0<=a;)(b=this.hasOwnProperty(a))&&(e=this[a]),a-=1;for(;0<=a;)(b=this.hasOwnProperty(a))&&(e=c.call(r,e,this[a],a,this)),a-=1;return e};f.some=f.some||function(c,d){var b=this.length,a;"function"!==typeof c&&m(Error("TypeError"));for(a=0;a<b;a+=
1)if(this.hasOwnProperty(a)&&c.call(d,this[a],a,this))return t;return z};f.every=f.every||function(c,d){var b=this.length,a;"function"!==typeof c&&m(Error("TypeError"));for(a=0;a<b;a+=1)if(this.hasOwnProperty(a)&&!c.call(d,this[a],a,this))return z;return t};f.contains=function(c){return 0<=this.indexOf(c)};f.occurances=function(c){for(var d=this.indexOf(c),b=0;0<=d;)b+=1,d=this.indexOf(c,d+1);return b};f.distinct=function(){for(var c=this.length,d=[],b;c;)c-=1,b=this[c],1===this.occurances(b)&&d.unshift(b);
return d};f.first=function(c,d){var b,a=this.length;"function"!==typeof c&&m(Error("TypeError"));for(b=0;b<a;b+=1)if(this.hasOwnProperty(b)&&c.call(d,this[b],b,this))return this[b]};f.last=function(c,d){var b=this.length;for("function"!==typeof c&&m(Error("TypeError"));b;)if(b-=1,this.hasOwnProperty(b)&&c.call(d,this[b],b,this))return this[b]};f.find=function(c,d,b){var a=this.length;"function"!==typeof c&&m(Error("TypeError"));"number"!==typeof d&&!b&&(b=d);if(isNaN(d)||0>d)d=0;for(;d<a;d+=1)if(this.hasOwnProperty(d)&&
c.call(b,this[d],d,this))return{item:this[d],index:d};return{item:r,index:-1}};f.equals=function(c,d){var b,a,e,f;if(!n.isArray(c))return z;if(this===c)return t;if(this.length!==c.length)return z;a=this.length;e=c.length;f=i.getItemOperators(this);d="function"===typeof d?d:function(){return f.equals.apply(f,arguments)};for(b=0;b<a&&b<e;b+=1)if(!d(this[b],c[b]))return z;return t};f.changed=function(c,d,b){var a,e,f,g;if(!n.isArray(c)||this===c)return z;if(this.length!==c.length)return t;g=i.getItemOperators(this);
d="function"===typeof d?d:function(){return g.equals.apply(g,arguments)};b="function"===typeof b?b:function(){return g.changed.apply(g,arguments)};e=this.length;f=c.length;for(a=0;a<e&&a<f;a+=1)if(!d(this[a],c[a])||b(this[a],c[a]))return t;return z};f.compare=function(c,d,b){var a,e=i(),f,g,k,j=this.find,p,l,c=i(c);a=i.getItemOperators(this);d="function"===typeof d?d:function(){return a.equals.apply(a,arguments)};b="function"===typeof b?b:function(){return a.changed.apply(a,arguments)};p=function(a){return d(k,
a)};g=this.length;for(f=0;f<g;f+=1)k=this[f],l=j.call(c,p),0>l.index?e.push(h("deleted",k,f)):(b(k,l.item)?e.push(h("changed",k,f,l.item,l.index)):e.push(h("retained",k,f,l.item,l.index)),delete c[l.index]);g=c.length;for(f=0;f<g;f+=1)c.hasOwnProperty(f)&&(k=c[f],0>this.find(p).index&&e.push(h("added",r,-1,k,f)));k=c=d=b=x;return e};f.merge=function(c,d,b){var a=i(this);a.mergeWith(c,d,b);return a};f.mergeWith=function(c,d,b){var a;i.getItemOperators(this);c=this.compare(c,d,b);b=c.length;for(d=0;d<
b;d+=1)switch(a=c[d],a.status){case "added":this[a.otherIndex]===r?this[a.otherIndex]=a.otherItem:this.splice(a.otherIndex,0,a.otherItem);break;case "deleted":this[a.index]=r;break;case "changed":a.index!==a.otherIndex?this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item)):this[a.index]=a.otherItem;break;case "retained":a.index!==a.otherIndex?this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,
1),this.splice(a.otherIndex,0,a.item)):this[a.index]=a.otherItem}this.collapse()};f.remove=function(){var c,d,b,a=arguments.length;for(c=0;c<a;c+=1){b=arguments[c];for(d=this.length;d;)d-=1,this[d]===b&&this.splice(d,1)}};f.removeAt=function(c){if(isFinite(c)&&0<=c&&c<this.length)return this.splice(c,1).pop()};f.clear=function(){for(;this.length;)this.pop()};f.collapse=function(){for(var c=this.length;c;)c-=1,this[c]===r&&this.splice(c,1)};f.replaceAt=function(c,d){var b;isFinite(c)&&0<=c&&c<this.length&&
(b=this[c],this[c]=d);return b};f.isEmpty=function(){return 0===this.length};f.peek=function(){return this[this.length-1]};f.insert=function(c,d){c>this.length?c=this.length:0>c&&(c=0);return isFinite(parseInt(c,10))?(c===this.length?this.push(d):this.hasOwnProperty(c)?this.splice(c,0,d):this[c]=d,c):z};(function(c){var d=c.length;1===d&&n.isArray(e)?f.push.apply(f,e):d&&f.push.apply(f,f.slice.call(c))})(arguments);return f}function h(e,f,c,d,b){return{status:e,item:f,value:f,index:c,otherItem:d,
otherIndex:b,toString:function(){return n.format("{status: {0}, item: {1}, index: {2}, otherItem: {3}, otherIndex: {4}}",e,f,c,d,b)}}}var g={equals:function(e,f){e=e?e.valueOf():e;f=f?f.valueOf():f;return e===f},changed:function(e,f){e=e?e.valueOf():e;f=f?f.valueOf():f;return e!==f}};i.getItemOperators=function(e){e=e.getItemOperators();"function"!==typeof e.equals&&(e.equals=g.equals);"function"!==typeof e.changed&&(e.changed=g.changed);return e};i.interfce={concat:"function",indexOf:"function",
join:"function",lastIndexOf:"function",map:"function",filter:"function",forEach:"function",reduce:"function",reduceRight:"function",reverse:"function",some:"function",shift:"function",slice:"function",sort:"function",splice:"function",every:"function",pop:"function",push:"function",unshift:"function",toString:"function",contains:"function",occurances:"function",distinct:"function",first:"function",last:"function",find:"function",equals:"function",changed:"function",compare:"function",merge:"function",
mergeWith:"function",remove:"function",removeAt:"function",clear:"function",collapse:"function",replaceAt:"function",isEmpty:"function",peek:"function",insert:"function"};return i}(),A=function(){function i(){var e=u(),f=0,c=z,d=[],b=-1;return{block:function(){d.push(t)},unblock:function(){d.pop()},subscribe:function(a,c){return a&&!e.contains(a)?(a.thisObj=c||r,e.push(a),{dispose:function(){e.remove(a)}}):{dispose:function(){}}},throttle:function(a){isFinite(a)||(a=0);f=a},notify:function(){var a=
this,i=g.call(arguments);!d.length&&!c&&(c=t,0<f?b=setTimeout(function(){h(a,e,i);c=z},f):(h(a,e,i),c=z))},dispose:function(){e.clear();clearTimeout(b)}}}function h(e,f,c){var d,b=f.length,c=c.slice();c.unshift(e);for(e=0;e<b;e+=1)(d=f[e])&&("function"===typeof d?d.apply(d.thisObj,c):"function"===typeof d.onNotify&&d.onNotify.apply(d,c))}var g=D.prototype.slice;i.interfce={block:"function",unblock:"function",subscribe:"function",throttle:"function",notify:"function",dispose:"function"};return i}(),
E=function(){function i(){function h(c,d,b,a,e){d=parseInt(d,10);a=parseInt(a,10);return{action:c,newStartingIndex:isFinite(d)?d:-1,newItems:n.isArray(b)?b:b===x||b===r?[]:[b],oldStartingIndex:isFinite(a)?a:-1,oldItems:n.isArray(e)?e:e===x||e===r?[]:[e]}}var g=[].slice,e=u.apply(r,g.call(arguments)),f={add:function(c,d){e.notify(h("add",c,d))},remove:function(c,d){e.notify(h("remove",x,x,c,d))},replace:function(c,d,b,a){e.notify(h("replace",c,d,b,a))},move:function(c,d,b,a){e.notify(h("move",c,d,
b,a))},reset:function(){e.notify(h("reset"))}};n.mixin(e,A());e.replaceAt=function(c){return function(d,b){var a;0<=d&&d<this.length&&(this.block(),a=c.call(this,d,b),this.unblock(),f.replace(d,b,d,a));return a}}(e.replaceAt);e.clear=function(c){return function(){var d=this.length;this.block();c.call(this);this.unblock();d!==this.length&&f.reset()}}(e.clear);e.collapse=function(c){return function(){var d=this.length;this.block();c.call(this);this.unblock();d!==this.length&&f.reset()}}(e.collapse);
e.insert=function(c){return function(d,b){this.block();var a=c.call(this,d,b);this.unblock();a!==z&&f.add(a,b);return a}}(e.insert);e.mergeWith=function(){return function(c,d,b){var a,e=[];this.block();u.getItemOperators(this);c=this.compare(c,d,b);b=c.length;for(d=0;d<b;d+=1)switch(a=c[d],a.status){case "added":e.push(h("add",a.otherIndex,a.otherItem));this[a.otherIndex]===r?this[a.otherIndex]=a.otherItem:this.splice(a.otherIndex,0,a.otherItem);break;case "deleted":e.push(h("remove",x,x,a.index,
a.item));this[a.index]=r;break;case "changed":a.index!==a.otherIndex?(e.push(h("move",a.otherIndex,a.otherItem,a.index,a.item)),this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item))):(e.push(h("replace",a.index,a.otherItem,a.index,a.item)),this[a.index]=a.otherItem);break;case "retained":a.index!==a.otherIndex?(e.push(h("move",a.otherIndex,a.otherItem,a.index,a.item)),this[a.otherIndex]===r?(this[a.index]=r,this[a.otherIndex]=
a.otherItem):(this.splice(a.index,1),this.splice(a.otherIndex,0,a.item))):this[a.index]=a.otherItem}this.collapse();for(this.unblock();e.length;)this.notify(e.shift())}}(e.mergeWith);e.reverse=function(c){return function(){this.block();c.call(this);this.unblock();f.reset();return this}}(e.reverse);e.pop=function(c){return function(){var d=this.length,b;this.block();b=c.call(this);this.unblock();d!==this.length&&f.remove(d-1,b);return b}}(e.pop);e.push=function(c){return function(){var d=this.length,
b=g.call(arguments),a;this.block();a=c.apply(this,b);this.unblock();d!==a&&f.add(d,b);return a}}(e.push);e.shift=function(c){return function(){var d=this.length,b;this.block();b=c.call(this);this.unblock();d!==this.length&&f.remove(0,b);return b}}(e.shift);e.unshift=function(c){return function(){var d=this.length,b=g.call(arguments),a;this.block();a=c.apply(this,b);this.unblock();d!==this.length&&f.add(0,b);return a}}(e.unshift);e.sort=function(c){return function(){c.apply(this,g.call(arguments));
f.reset();return this}}(e.sort);e.splice=function(c){return function(){var d=this.length,b=g.call(arguments),a=b.shift(),e;b.shift();a=parseInt(a,10);a=isFinite(a)?a:0;0>a?a=0:a>this.length&&(a=this.length);this.block();e=c.apply(this,g.call(arguments));this.unblock();d!==this.length&&(0===b.length&&0!==e.length?f.remove(a,e):0!==b.length&&0===e.length?f.add(a,b):f.replace(a,b,a,e));return e}}(e.splice);return e}i.interfce=n.mixin({},A.interfce,u.interfce);return i}(),w=function(){var i,h,g=u();g.b=
function(e){this.push(e)};g.a=function(e){this.length&&this.peek().dependencies().add(e)};i=function(e,f,c){function d(){var a=D.prototype.slice.call(arguments,1);k=r;j.notify.apply(j,a)}var b=z,a=u(),i=[],o,y,k,j;a.add=function(a){this.contains(a)||(this.push(a),i.push(a.subscribe(d)))};j=function(a){var c,b=j.owner;this!==r&&(j.owner=this);arguments.length?(j.set(a),c=this):c=j.get();j.owner=b;return c};j.equals=function(a){var c=this.get(),a=h(a),c=c?c.valueOf():c,a=a?a.valueOf():a;return c===
a};j.changed=function(a){var c=this.get(),a=h(a),c=c?c.valueOf():c,a=a?a.valueOf():a;return c!==a};j.clearMemo=function(){k=r};j.get=function(){b||(g.a(this),g.b(this));var a=k===r?y.call(this.owner):k;k=a;g[g.length-1]===this&&g.pop();return a};j.set=function(a){if("function"===typeof o){b=t;if(!this.equals(a)||this.changed(a))this.block(),o.call(this.owner,a),k=r,this.unblock(),this.notify();b=z}};j.dependencies=function(){return a};j.isDependent=function(){return 0!==a.length};j.toString=function(){return n.str(this.get())};
j.valueOf=function(){var a=this.get();return n.isNil(a)?a:a.valueOf()};n.mixin(j,A());(function(){var b,g=j,k=z,q=n.isObject,v=n.isArray,w=n.adheresTo;g.owner=r;"function"===typeof e?(y=e,o="function"===typeof f?f:x,g.owner="function"===typeof f?c:f):q(e)&&"function"===typeof e.get?(k=e.lazy,y=e.get,o="function"===typeof e.set?e.set:x,g.equals="function"===typeof e.equals?e.equals:g.equals,g.changed="function"===typeof e.changed?e.changed:g.changed,g.owner=e.owner):(q(e)?(g.equals="function"===typeof e.equals?
e.equals:g.equals,g.changed="function"===typeof e.changed?e.changed:g.changed,b=e.value):b=e,v(b)&&!w(b,A.interfce)&&(b=E(b),b.getItemOperators=function(a,b,c){a=typeof a==="function"?a:c.equals;b=typeof b==="function"?b:c.changed;return function(){return{equals:a,changed:b}}}(e.equals,e.changed,b.getItemOperators()),g.equals=function(a){a=h(a);return b.equals(a)},g.changed=function(a){a=h(a);return b.changed(a)}),b&&"function"===typeof b.subscribe&&"function"===typeof b.dispose&&i.push(b.subscribe(d)),
y=function(){return b},o=function(a){if(w(b,u.interfce)){b.clear();v(a)?b.push.apply(b,a):b.push(a)}else if(v(b)){for(;b.length;)b.pop();v(a)?b.push.apply(b,a):b.push(a)}else b!==a&&(b=a)});g.dispose=function(b){return function(){for(;i.length;)i.pop().dispose();for(;a.length;)a.pop();b.call(this)}}(g.dispose);k||j.get()})();return j};h=function(e){return e&&"function"===typeof e.get?e.get():e};i.get=h;i.interfce=n.mixin({dependencies:"function",isDependent:"function",clearMemo:"function",get:"function",
set:"function",equals:"function",changed:"function"},A.interfce);return i}();return{makeList:u,makeObservable:A,makeObservableList:E,makeProperty:w,makeBinding:function(){function i(h,g,e){var f=w.interfce,c=[],e=e||"twoway",e=n.str(e),e=e.toLowerCase();n.adheresTo(h,f)||m(Error("Binding source must be an observable property. "+h));n.adheresTo(g,f)||m(Error("Binding sink must be an observable property. "+g));g.set(h.get());switch(e){case "oneway":f=h.subscribe(function(){g.set(h.get())});c.push(f);
break;case "twoway":f=h.subscribe(function(){g.set(h.get())}),c.push(f),f=g.subscribe(function(){h.set(g.get())}),c.push(f)}f=x;return{type:function(){return e},source:function(){return h},sink:function(){return g},dispose:function(){for(;c.length;)c.pop().dispose()}}}i.interfce={type:"function",source:"function",sink:"function",dispose:"function"};return i}(),toJSON:v,fromJSON:o}}xport.module(["utiljs"],v,function(){xport("BINDER",v(UTIL))})})();
